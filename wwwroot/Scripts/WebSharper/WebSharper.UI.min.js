(function(a){"use strict";var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_0,_1,_2,_3,_4,_5,_6,_7,_8,_9,_,$,ba,bb,bc,bd,be,bf,bg,bh,bi,bj,bk,bl,bm,bn,bo,bp,bq,br,bs,bt,bu,bv,bw,bx,by,bz,bA,bB,bC,bD,bE,bF,bG,bH,bI,bJ,bK,bL,bM,bN,bO,bP,bQ,bR,bS,bT,bU,bV,bW,bX,bY,bZ,b0,b1,b2,b3,b4,b5;b=a.WebSharper=a.WebSharper||{};c=b.UI=b.UI||{};d=c.Array=c.Array||{};e=c.String=c.String||{};f=c.List=c.List||{};g=c.Abbrev=c.Abbrev||{};h=g.Fresh=g.Fresh||{};i=g.HashSet=g.HashSet||{};j=g.Dict=g.Dict||{};k=b&&b.Obj;l=g.Slot=g.Slot||{};m=g.Async=g.Async||{};n=g.Mailbox=g.Mailbox||{};o=a.StartupCode$WebSharper_UI$Abbrev=a.StartupCode$WebSharper_UI$Abbrev||{};p=c.AppendList=c.AppendList||{};q=a.StartupCode$WebSharper_UI$AppendList=a.StartupCode$WebSharper_UI$AppendList||{};r=c.DomUtility=c.DomUtility||{};s=a.StartupCode$WebSharper_UI$DomUtility=a.StartupCode$WebSharper_UI$DomUtility||{};t=c.Trie=c.Trie||{};u=t.LookupResult=t.LookupResult||{};v=a.StartupCode$WebSharper_UI$Trie=a.StartupCode$WebSharper_UI$Trie||{};w=c.Snap=c.Snap||{};x=c.Var=c.Var||{};y=c.View=c.View||{};z=c.ConcreteVar=c.ConcreteVar||{};A=c.Var$1=c.Var$1||{};B=c.Updates=c.Updates||{};C=c.FromView=c.FromView||{};D=c.ViewBuilder=c.ViewBuilder||{};E=c.Submitter=c.Submitter||{};F=c.Key=c.Key||{};G=c.Model=c.Model||{};H=c.Serializer=c.Serializer||{};I=c.Storage=c.Storage||{};J=I.ArrayStorage=I.ArrayStorage||{};K=I.LocalStorageBackend=I.LocalStorageBackend||{};L=c.ListModel=c.ListModel||{};M=c.ListModels=c.ListModels||{};N=a.StartupCode$WebSharper_UI$Models=a.StartupCode$WebSharper_UI$Models||{};O=c.ReactiveExtensions=c.ReactiveExtensions||{};P=c.DoubleInterpolation=c.DoubleInterpolation||{};Q=c.Interpolation=c.Interpolation||{};R=c.Easing=c.Easing||{};S=c.Easings=c.Easings||{};T=c.An=c.An||{};U=c.Anims=c.Anims||{};V=c.Trans=c.Trans||{};W=a.StartupCode$WebSharper_UI$Animation=a.StartupCode$WebSharper_UI$Animation||{};X=b&&b.Web;Y=X&&X.Control;Z=c.OnAfterRenderControl=c.OnAfterRenderControl||{};_0=c.AnimatedAttrNode=c.AnimatedAttrNode||{};_1=c.DynamicAttrNode=c.DynamicAttrNode||{};_2=c.AttrProxy=c.AttrProxy||{};_3=c.Client=c.Client||{};_4=_3.Attrs=_3.Attrs||{};_5=_4.Dyn=_4.Dyn||{};_6=c.Attrs=c.Attrs||{};_7=c.CheckedInput=c.CheckedInput||{};_8=c.BindVar=c.BindVar||{};_9=c.AttrModule=c.AttrModule||{};_=a.StartupCode$WebSharper_UI$Attr_Client=a.StartupCode$WebSharper_UI$Attr_Client||{};$=X&&X.FSharpInlineControl;ba=c.InlineControlWithPlaceHolder=c.InlineControlWithPlaceHolder||{};bb=_3.Settings=_3.Settings||{};bc=c.DocElemNode=c.DocElemNode||{};bd=_3.Docs=_3.Docs||{};be=bd.DomNodes=bd.DomNodes||{};bf=bd.NodeSet=bd.NodeSet||{};bg=bd.RunState=bd.RunState||{};bh=c.Docs=c.Docs||{};bi=c.Doc=c.Doc||{};bj=c.Elt=c.Elt||{};bk=_3.EltUpdater=_3.EltUpdater||{};bl=a.StartupCode$WebSharper_UI$Doc_Proxy=a.StartupCode$WebSharper_UI$Doc_Proxy||{};bm=_3.Templates=_3.Templates||{};bn=bm.Prepare=bm.Prepare||{};bo=a.StartupCode$WebSharper_UI$Templates=a.StartupCode$WebSharper_UI$Templates||{};bp=c.Flow=c.Flow||{};bq=c.FlowBuilder=c.FlowBuilder||{};br=c.HtmlModule=c.HtmlModule||{};bs=br.attr=br.attr||{};bt=c.Router=c.Router||{};bu=c.Route=c.Route||{};bv=c.Routing=c.Routing||{};bw=c.RouteMap=c.RouteMap||{};bx=c.Input=c.Input||{};by=bx.MousePosSt=bx.MousePosSt||{};bz=bx.MouseBtnSt=bx.MouseBtnSt||{};bA=bx.Mouse=bx.Mouse||{};bB=bx.KeyListenerSt=bx.KeyListenerSt||{};bC=bx.Keyboard=bx.Keyboard||{};bD=a.StartupCode$WebSharper_UI$Input=a.StartupCode$WebSharper_UI$Input||{};bE=b&&b.List;bF=b&&b.Arrays;bG=b&&b.Enumerator;bH=b&&b.Strings;bI=b&&b.Char;bJ=b&&b.Collections;bK=bJ&&bJ.HashSet;bL=b&&b.Seq;bM=b&&b.Runtime;bN=b&&b.Unchecked;bO=a.console;bP=b&&b.Concurrency;bQ=bJ&&bJ.Map;bR=bJ&&bJ.FSharpMap;bS=b&&b.Operators;bT=b&&b.Queue;bU=b&&b.Lazy;bV=bJ&&bJ.Dictionary;bW=a.JSON;bX=b&&b.DateUtil;bY=b&&b.Numeric;bZ=a.Node;b0=b&&b.Slice;b1=b&&b.Sitelets;b2=b1&&b1.RouterModule;b3=b1&&b1.Route;b4=b&&b.Utils;b5=b&&b.Option;d.mapInPlace=function(b6,b7){var b8,b9;for(b8=0,b9=b7.length-1;b8<=b9;b8++)b7[b8]=b6(b7[b8]);return b7;};d.ofSeqNonCopying=function(b6){var b7,b8;if(b6 instanceof a.Array)return b6;else if(b6 instanceof bE.T)return bF.ofList(b6);else if(b6===null)return[];else{b7=[];b8=bG.Get(b6);try{while(b8.MoveNext())b7.push(b8.Current());return b7;}finally{if(typeof b8=="object"&&"Dispose"in b8)b8.Dispose();}}};d.MapTreeReduce=function(b6,b7,b8,b9){var b_;function b$(ca){return function(cb){var cc,cd;switch(cb<=0?0:cb===1?ca>=0&&ca<b_?1:(cc=cb,2):(cc=cb,2)){case 0:return b7;case 1:return b6(bF.get(b9,ca));case 2:cd=cb/2>>0;return b8((b$(ca))(cd),(b$(ca+cd))(cb-cd));}};}b_=bF.length(b9);return(b$(0))(b_);};d.TreeReduce=function(b6,b7,b8){var b9;function b_(b$){return function(ca){var cb,cc;switch(ca<=0?0:ca===1?b$>=0&&b$<b9?1:(cb=ca,2):(cb=ca,2)){case 0:return b6;case 1:return bF.get(b8,b$);case 2:cc=ca/2>>0;return b7((b_(b$))(cc),(b_(b$+cc))(ca-cc));}};}b9=bF.length(b8);return(b_(0))(b9);};e.isBlank=function(b6){return bH.forall(bI.IsWhiteSpace,b6);};f.maybeReplaceFirst=function(b6,b7,b8){var b9;b9=[false];return bE.map(function(b_){var b$;return!b9[0]&&b6(b_)?(b$=b7(b_),b$==null?b_:b$.$0):b_;},b8);};f.replaceFirst=function(b6,b7,b8){var b9;b9=[false];return bE.map(function(b_){return!b9[0]&&b6(b_)?b7(b_):b_;},b8);};h.Id=function(){h.set_counter(h.counter()+1);return"uid"+a.String(h.counter());};h.Int=function(){h.set_counter(h.counter()+1);return h.counter();};h.counter=function(){o.$cctor();return o.counter;};h.set_counter=function(b6){o.$cctor();o.counter=b6;};i.Filter=function(b6,b7){return new bK.New$2(bF.filter(b6,i.ToArray(b7)));};i.Intersect=function(b6,b7){var b8;b8=new bK.New$2(i.ToArray(b6));b8.IntersectWith(i.ToArray(b7));return b8;};i.Except=function(b6,b7){var b8;b8=new bK.New$2(i.ToArray(b7));b8.ExceptWith(i.ToArray(b6));return b8;};i.ToArray=function(b6){var b7;b7=bF.create(b6.Count(),void 0);b6.CopyTo(b7,0);return b7;};j.ToValueArray=function(b6){var b7;b7=bF.create(b6.count,void 0);bL.iteri(function(b8,b9){return bF.set(b7,b8,b9.V);},b6);return b7;};j.ToKeyArray=function(b6){var b7;b7=bF.create(b6.count,void 0);bL.iteri(function(b8,b9){return bF.set(b7,b8,b9.K);},b6);return b7;};l=g.Slot=bM.Class({GetHashCode:function(){return bN.Hash(this.key(this.value));},Equals:function(b6){return bN.Equals(this.key(this.value),this.key(b6.get_Value()));},get_Value:function(){return this.value;}},k,l);l.New=bM.Ctor(function(b6,b7){k.New.call(this);this.key=b6;this.value=b7;},l);l.Create=function(b6,b7){return new l.New(b6,b7);};m.OnError=function(b6){return bO.log("WebSharper UI: Uncaught asynchronous exception",b6);};m.StartTo=function(b6,b7){bP.StartWithContinuations(b6,b7,function(b8){m.OnError(b8);},a.ignore,null);};n.StartProcessor=function(b6){var b7;function b8(){var b9;b9=null;return bP.Delay(function(){return bP.Bind(b6,function(){var b_;b_=b7[0];return bN.Equals(b_,1)?(b7[0]=0,bP.Zero()):bN.Equals(b_,2)?(b7[0]=1,b8()):bP.Zero();});});}b7=[0];return function(){var b9;b9=b7[0];if(bN.Equals(b9,0)){b7[0]=1;bP.Start(b8(),null);}else bN.Equals(b9,1)?b7[0]=2:void 0;};};o.$cctor=function(){o.$cctor=a.ignore;o.counter=0;};p.FromArray=function(b6){var b7;b7=b6.length;return b7===0?{$:0}:b7===1?{$:1,$0:bF.get(b6,0)}:{$:3,$0:b6.slice()};};p.ToArray=function(b6){var b7;function b8(b9){var b_,b$;while(true)if(b9.$==1)return b7.push(b9.$0);else if(b9.$==2){b_=b9.$1;b$=b9.$0;b8(b$);b9=b_;}else return b9.$==3?bF.iter(function(ca){b7.push(ca);},b9.$0):null;}b7=[];b8(b6);return b7.slice(0);};p.Single=function(b6){return{$:1,$0:b6};};p.Concat=function(b6){var b7;b7=d.ofSeqNonCopying(b6);return d.TreeReduce(p.Empty(),p.Append,b7);};p.Append=function(b6,b7){return b6.$==0?b7:b7.$==0?b6:{$:2,$0:b6,$1:b7};};p.Empty=function(){q.$cctor();return q.Empty;};q.$cctor=function(){q.$cctor=a.ignore;q.Empty={$:0};};r.ParseHTMLIntoFakeRoot=function(b6){var b7,b8,b9,b_,b$;function ca(cb,cc){var cd;while(true)if(cc===0)return cb;else{cd=cc;cb=cb.lastChild;cc=cd-1;}}b7=self.document.createElement("div");return!r.rhtml().test(b6)?(b7.appendChild(self.document.createTextNode(b6)),b7):(b8=(b9=r.rtagName().exec(b6),bN.Equals(b9,null)?"":bF.get(b9,1).toLowerCase()),(b_=(b$=(r.wrapMap())[b8],b$?b$:r.defaultWrap()),(b7.innerHTML=b_[1]+b6.replace(r.rxhtmlTag(),"<$1></$2>")+b_[2],ca(b7,b_[0]))));};r.defaultWrap=function(){s.$cctor();return s.defaultWrap;};r.wrapMap=function(){s.$cctor();return s.wrapMap;};r.rhtml=function(){s.$cctor();return s.rhtml;};r.rtagName=function(){s.$cctor();return s.rtagName;};r.rxhtmlTag=function(){s.$cctor();return s.rxhtmlTag;};r.IterSelectorDoc=function(b6,b7){var b8,b9,b_;b8=self.document.querySelectorAll(b6);for(b9=0,b_=b8.length-1;b9<=b_;b9++)b7(b8[b9]);};r.IterSelector=function(b6,b7,b8){var b9,b_,b$;b9=b6.querySelectorAll(b7);for(b_=0,b$=b9.length-1;b_<=b$;b_++)b8(b9[b_]);};r.ChildrenArray=function(b6){var b7,b8,b9;b7=[];for(b8=0,b9=b6.childNodes.length-1;b8<=b9;b8++)b7.push(b6.childNodes[b8]);return b7;};r.RemoveClass=function(b6,b7){var b8;r.setClass(b6,(b8=r.clsRE(b7),r.getClass(b6).replace(b8,function(b9,b_,b$){return b_===""||b$===""?"":" ";})));};r.AddClass=function(b6,b7){var b8;b8=r.getClass(b6);if(b8==="")r.setClass(b6,b7);else!r.clsRE(b7).test(b8)?r.setClass(b6,b8+" "+b7):void 0;};r.setClass=function(b6,b7){if(b6 instanceof a.SVGElement)b6.setAttribute("class",b7);else b6.className=b7;};r.getClass=function(b6){return b6 instanceof a.SVGElement?b6.getAttribute("class"):b6.className;};r.clsRE=function(b6){return new a.RegExp("(\\s+|^)"+b6+"(?:\\s+"+b6+")*(\\s+|$)","g");};r.InsertAt=function(b6,b7,b8){var b9;if(!(b8.parentNode===b6&&b7===(b9=b8.nextSibling,bN.Equals(b9,null)?null:b9)))b6.insertBefore(b8,b7);};r.RemoveNode=function(b6,b7){if(b7.parentNode===b6)b6.removeChild(b7);};s.$cctor=function(){var b6;s.$cctor=a.ignore;s.rxhtmlTag=new a.RegExp("<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\\w:]+)[^>]*)\\/>","gi");s.rtagName=new a.RegExp("<([\\w:]+)");s.rhtml=new a.RegExp("<|&#?\\w+;");s.wrapMap=(b6=[1,"<table>","</table>"],{option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],area:[1,"<map>","</map>"],param:[1,"<object>","</object>"],thead:b6,tbody:b6,tfoot:b6,tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><colgroup>","</colgoup></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"]});s.defaultWrap=[0,"",""];};u.NotFound={$:1};t.Empty=function(){v.$cctor();return v.Empty;};t.Lookup=function(b6,b7){return t.Look(bE.ofSeq(b7),b6);};t.Look=function(b6,b7){var b8,b9;switch(b7.$==2?(b8=b7.$0,0):b7.$==0?b6.$==1?(b8=[b6.$0,b6.$1,b7.$0],1):2:2){case 0:return{$:0,$0:b8,$1:b6};case 1:b9=b8[2].TryFind(b8[0]);return b9==null?u.NotFound:t.Look(b8[1],b9.$0);case 2:return u.NotFound;}};t.ToArray=function(b6){var b7;b7=[];t.Map(function(){return function(b8){return b7.push(b8);};},b6);return b7.slice(0);};t.Mapi=function(b6,b7){var b8;function b9(){var b_;b_=b8[0];b8[0]=b_+1;return b_;}b8=[0];return t.Map(function(b_){return b6(b9(),b_);},b7);};t.Map=function(b6,b7){return t.MapLoop(bE.T.Empty,b6,b7);};t.MapLoop=function(b6,b7,b8){return b8.$==1?{$:1}:b8.$==2?{$:2,$0:(b7(b6))(b8.$0)}:t.TrieBranch(bQ.Map(function(b9,b_){return t.MapLoop(bE.append(b6,bE.ofArray([b9])),b7,b_);},b8.$0));};t.Merge=function(b6){var b7,b8,b9;b7=d.ofSeqNonCopying(b6);b8=bF.length(b7);return b8===0?{$:1,$0:{$:1}}:b8===1?{$:1,$0:bF.get(b7,0)}:bF.exists(t.IsLeaf,b7)?null:(b9=t.MergeMaps(t.Merge,bL.choose(function(b_){return b_.$==0?{$:1,$0:b_.$0}:null;},b7)),b9==null?null:{$:1,$0:t.TrieBranch(b9.$0)});};t.IsLeaf=function(b6){return b6.$==2;};t.MergeMaps=function(b6,b7){var b8,b9;function b_(b$,ca){var cb;cb=b6(ca);return cb==null?null:{$:1,$0:[b$,cb.$0]};}b8=t.AllSome(bL.map(function(b$){return b_(b$[0],b$[1]);},bQ.ToSeq((b9=bL.collect(bQ.ToSeq,b7),bL.fold(function(b$,ca){return t.MultiAdd(ca[0],ca[1],b$);},new bR.New([]),b9)))));return b8==null?null:{$:1,$0:bQ.OfArray(bF.ofSeq(b8.$0))};};t.AllSome=function(b6){var b7,b8,b9,b_;b8=bG.Get(b6);b9=bM.MarkResizable([]);b7=true;while(b7&&b8.MoveNext()){b_=b8.Current();if(b_!=null&&b_.$==1)b9.push(b_.$0);else b7=false;}return b7?{$:1,$0:b9.slice()}:null;};t.MultiAdd=function(b6,b7,b8){return b8.Add$1(b6,new bE.T({$:1,$0:b7,$1:t.MultiFind(b6,b8)}));};t.MultiFind=function(b6,b7){var b8;b8=b7.TryFind(b6);return b8==null?bE.T.Empty:b8.$0;};t.Prefix=function(b6,b7){return t.TrieBranch(new bR.New(bE.ofArray([[b6,b7]])));};t.Leaf=function(b6){return{$:2,$0:b6};};t.TrieBranch=function(b6){return b6.get_IsEmpty()?{$:1}:{$:0,$0:b6};};v.$cctor=function(){v.$cctor=a.ignore;v.Empty={$:1};};w.Obsolete=function(b6){var b7,b8,b9,b_,b$;b8=b6.s;if(b8==null||(b8!=null&&b8.$==2?(b7=b8.$1,false):b8!=null&&b8.$==3?(b7=b8.$1,false):true))void 0;else{b6.s=null;for(b9=0,b_=bF.length(b7)-1;b9<=b_;b9++){b$=bF.get(b7,b9);if(typeof b$=="object")(function(ca){w.Obsolete(ca);}(b$));else b$();}}};w.New=function(b6){return{s:b6};};w.MapAsync=function(b6,b7){var b8;b8=w.New({$:3,$0:[],$1:[]});w.When(b7,function(b9){m.StartTo(b6(b9),function(b_){w.MarkDone(b8,b7,b_);});},b8);return b8;};w.SnapshotOn=function(b6,b7){var b8;function b9(b_){var b$,ca,cb;if(!(b$=b8.s,b$!=null&&b$.$==0||b$!=null&&b$.$==2)){ca=w.ValueAndForever(b6);cb=w.ValueAndForever(b7);if(ca!=null&&ca.$==1)cb!=null&&cb.$==1?ca.$0[1]||cb.$0[1]?w.MarkForever(b8,cb.$0[0]):w.MarkReady(b8,cb.$0[0]):void 0;}}b8=w.New({$:3,$0:[],$1:[]});w.When(b6,b9,b8);w.WhenReady(b7,b9);return b8;};w.Map3=function(b6,b7,b8,b9){var b_,b$,ca,cb;function cc(cd){var ce,cf,cg,ch;if(!(ce=cb.s,ce!=null&&ce.$==0||ce!=null&&ce.$==2)){cf=w.ValueAndForever(b7);cg=w.ValueAndForever(b8);ch=w.ValueAndForever(b9);if(cf!=null&&cf.$==1)cg!=null&&cg.$==1?ch!=null&&ch.$==1?cf.$0[1]&&cg.$0[1]&&ch.$0[1]?w.MarkForever(cb,b6(cf.$0[0],cg.$0[0],ch.$0[0])):w.MarkReady(cb,b6(cf.$0[0],cg.$0[0],ch.$0[0])):void 0:void 0;}}b_=b7.s;b$=b8.s;ca=b9.s;return b_!=null&&b_.$==0?b$!=null&&b$.$==0?ca!=null&&ca.$==0?w.New({$:0,$0:b6(b_.$0,b$.$0,ca.$0)}):w.Map3Opt1(b6,b_.$0,b$.$0,b9):ca!=null&&ca.$==0?w.Map3Opt2(b6,b_.$0,ca.$0,b8):w.Map3Opt3(b6,b_.$0,b8,b9):b$!=null&&b$.$==0?ca!=null&&ca.$==0?w.Map3Opt4(b6,b$.$0,ca.$0,b7):w.Map3Opt5(b6,b$.$0,b7,b9):ca!=null&&ca.$==0?w.Map3Opt6(b6,ca.$0,b7,b8):(cb=w.New({$:3,$0:[],$1:[]}),(w.When(b7,cc,cb),w.When(b8,cc,cb),w.When(b9,cc,cb),cb));};w.Map3Opt6=function(b6,b7,b8,b9){return w.Map2(function(b_,b$){return b6(b_,b$,b7);},b8,b9);};w.Map3Opt5=function(b6,b7,b8,b9){return w.Map2(function(b_,b$){return b6(b_,b7,b$);},b8,b9);};w.Map3Opt4=function(b6,b7,b8,b9){return w.Map(function(b_){return b6(b_,b7,b8);},b9);};w.Map3Opt3=function(b6,b7,b8,b9){return w.Map2(function(b_,b$){return b6(b7,b_,b$);},b8,b9);};w.Map3Opt2=function(b6,b7,b8,b9){return w.Map(function(b_){return b6(b7,b_,b8);},b9);};w.Map3Opt1=function(b6,b7,b8,b9){return w.Map(function(b_){return b6(b7,b8,b_);},b9);};w.Map2Unit=function(b6,b7){var b8,b9,b_;function b$(){var ca,cb,cc;if(!(ca=b_.s,ca!=null&&ca.$==0||ca!=null&&ca.$==2)){cb=w.ValueAndForever(b6);cc=w.ValueAndForever(b7);if(cb!=null&&cb.$==1)cc!=null&&cc.$==1?cb.$0[1]&&cc.$0[1]?w.MarkForever(b_,null):w.MarkReady(b_,null):void 0;}}b8=b6.s;b9=b7.s;return b8!=null&&b8.$==0?b9!=null&&b9.$==0?w.New({$:0,$0:null}):b7:b9!=null&&b9.$==0?b6:(b_=w.New({$:3,$0:[],$1:[]}),(w.When(b6,b$,b_),w.When(b7,b$,b_),b_));};w.Map2=function(b6,b7,b8){var b9,b_,b$;function ca(cb){var cc,cd,ce;if(!(cc=b$.s,cc!=null&&cc.$==0||cc!=null&&cc.$==2)){cd=w.ValueAndForever(b7);ce=w.ValueAndForever(b8);if(cd!=null&&cd.$==1)ce!=null&&ce.$==1?cd.$0[1]&&ce.$0[1]?w.MarkForever(b$,b6(cd.$0[0],ce.$0[0])):w.MarkReady(b$,b6(cd.$0[0],ce.$0[0])):void 0;}}b9=b7.s;b_=b8.s;return b9!=null&&b9.$==0?b_!=null&&b_.$==0?w.New({$:0,$0:b6(b9.$0,b_.$0)}):w.Map2Opt1(b6,b9.$0,b8):b_!=null&&b_.$==0?w.Map2Opt2(b6,b_.$0,b7):(b$=w.New({$:3,$0:[],$1:[]}),(w.When(b7,ca,b$),w.When(b8,ca,b$),b$));};w.Map2Opt2=function(b6,b7,b8){return w.Map(function(b9){return b6(b9,b7);},b8);};w.Map2Opt1=function(b6,b7,b8){return w.Map(function(b9){return b6(b7,b9);},b8);};w.MapCachedBy=function(b6,b7,b8,b9){return w.Map(function(b_){var b$,ca,cb;b$=b7[0];return b$!=null&&b$.$==1&&(b6(b_,b$.$0[0])&&(ca=[b$.$0[0],b$.$0[1]],true))?ca[1]:(cb=b8(b_),(b7[0]={$:1,$0:[b_,cb]},cb));},b9);};w.Copy=function(b6){var b7,b8,b9;b7=b6.s;return b7==null?b6:b7!=null&&b7.$==2?(b8=w.New({$:2,$0:b7.$0,$1:[]}),(w.WhenObsolete(b6,b8),b8)):b7!=null&&b7.$==3?(b9=w.New({$:3,$0:[],$1:[]}),(w.When(b6,function(b_){w.MarkDone(b9,b6,b_);},b9),b9)):b6;};w.WithInitOption=function(b6){var b7,b8,b9;b7=b6.s;return b7==null?w.New(null):b7!=null&&b7.$==2?(b8=w.New({$:2,$0:{$:1,$0:b7.$0},$1:[]}),(w.WhenObsolete(b6,b8),b8)):b7!=null&&b7.$==3?(b9=w.New({$:2,$0:null,$1:[]}),(w.When(b6,function(){w.Obsolete(b9);},b9),b9)):w.New({$:0,$0:{$:1,$0:b7.$0}});};w.WithInit=function(b6,b7){var b8,b9,b_;b8=b7.s;return b8==null?b7:b8!=null&&b8.$==2?(b9=w.New({$:2,$0:b8.$0,$1:[]}),(w.WhenObsolete(b7,b9),b9)):b8!=null&&b8.$==3?(b_=w.New({$:2,$0:b6,$1:[]}),(w.When(b7,function(){w.Obsolete(b_);},b_),b_)):b7;};w.Map=function(b6,b7){var b8,b9;b8=b7.s;return b8!=null&&b8.$==0?w.New({$:0,$0:b6(b8.$0)}):(b9=w.New({$:3,$0:[],$1:[]}),(w.When(b7,function(b_){w.MarkDone(b9,b7,b6(b_));},b9),b9));};w.Sequence=function(b6){var b7,b8,b9;function b_(b$){var ca;if(b9[0]===0){ca=bF.map(function(cb){var cc;cc=cb.s;return cc!=null&&cc.$==0?cc.$0:cc!=null&&cc.$==2?cc.$0:bS.FailWith("value not found by View.Sequence");},b7);if(bF.forall(function(cb){var cc;cc=cb.s;return cc!=null&&cc.$==0;},b7))w.MarkForever(b8,ca);else w.MarkReady(b8,ca);}else b9[0]=b9[0]-1;}b7=bF.ofSeq(b6);return b7.length==0?w.New({$:0,$0:[]}):(b8=w.New({$:3,$0:[],$1:[]}),(b9=[bF.length(b7)-1],(bF.iter(function(b$){w.When(b$,b_,b8);},b7),b8)));};w.CreateForeverAsync=function(b6){var b7;b7=w.New({$:3,$0:[],$1:[]});m.StartTo(b6,function(b8){w.MarkForever(b7,b8);});return b7;};w.JoinInner=function(b6){var b7;b7=w.New({$:3,$0:[],$1:[]});w.When(b6,function(b8){var b9;b9=b8();w.When(b9,function(b_){var b$,ca;if((b$=b9.s,b$!=null&&b$.$==0)&&(ca=b6.s,ca!=null&&ca.$==0))w.MarkForever(b7,b_);else w.MarkReady(b7,b_);},b7);w.WhenObsolete(b6,b9);},b7);return b7;};w.Join=function(b6){var b7;b7=w.New({$:3,$0:[],$1:[]});w.When(b6,function(b8){var b9;b9=b8();w.When(b9,function(b_){var b$,ca;if((b$=b9.s,b$!=null&&b$.$==0)&&(ca=b6.s,ca!=null&&ca.$==0))w.MarkForever(b7,b_);else w.MarkReady(b7,b_);},b7);},b7);return b7;};w.ValueAndForever=function(b6){var b7;b7=b6.s;return b7!=null&&b7.$==0?{$:1,$0:[b7.$0,true]}:b7!=null&&b7.$==2?{$:1,$0:[b7.$0,false]}:null;};w.WhenObsoleteRun=function(b6,b7){var b8;b8=b6.s;if(b8==null)b7();else b8!=null&&b8.$==2?b8.$1.push(b7):b8!=null&&b8.$==3?b8.$1.push(b7):void 0;};w.WhenObsolete=function(b6,b7){var b8;b8=b6.s;if(b8==null)w.Obsolete(b7);else b8!=null&&b8.$==2?w.EnqueueSafe(b8.$1,b7):b8!=null&&b8.$==3?w.EnqueueSafe(b8.$1,b7):void 0;};w.WhenReady=function(b6,b7){var b8,b9;b9=b6.s;switch(b9!=null&&b9.$==2?(b8=b9.$0,0):b9==null?1:b9!=null&&b9.$==3?2:(b8=b9.$0,0)){case 0:b7(b8);break;case 1:null;break;case 2:b9.$0.push(b7);break;}};w.WhenRun=function(b6,b7,b8){var b9;b9=b6.s;if(b9==null)b8();else b9!=null&&b9.$==2?(b9.$1.push(b8),b7(b9.$0)):b9!=null&&b9.$==3?(b9.$0.push(b7),b9.$1.push(b8)):b7(b9.$0);};w.When=function(b6,b7,b8){var b9;b9=b6.s;if(b9==null)w.Obsolete(b8);else b9!=null&&b9.$==2?(w.EnqueueSafe(b9.$1,b8),b7(b9.$0)):b9!=null&&b9.$==3?(b9.$0.push(b7),w.EnqueueSafe(b9.$1,b8)):b7(b9.$0);};w.EnqueueSafe=function(b6,b7){var b8,b9,b_,b$;b6.push(b7);if(b6.length%20===0){b8=b6.slice(0);bT.Clear(b6);for(b9=0,b_=bF.length(b8)-1;b9<=b_;b9++){b$=bF.get(b8,b9);if(typeof b$=="object")(function(ca){if(ca.s)b6.push(ca);}(b$));else(function(ca){b6.push(ca);}(b$));}}else void 0;};w.MarkDone=function(b6,b7,b8){var b9;if(b9=b7.s,b9!=null&&b9.$==0)w.MarkForever(b6,b8);else w.MarkReady(b6,b8);};w.MarkReady=function(b6,b7){var b8,b9,b_,b$;b8=b6.s;if(b8!=null&&b8.$==3){b6.s={$:2,$0:b7,$1:b8.$1};b9=b8.$0;for(b_=0,b$=bF.length(b9)-1;b_<=b$;b_++)(bF.get(b9,b_))(b7);}else void 0;};w.MarkForever=function(b6,b7){var b8,b9,b_,b$;b8=b6.s;if(b8!=null&&b8.$==3){b6.s={$:0,$0:b7};b9=b8.$0;for(b_=0,b$=bF.length(b9)-1;b_<=b$;b_++)(bF.get(b9,b_))(b7);}else void 0;};w.TryGet=function(b6){var b7,b8;b7=b6.s;return(b7!=null&&b7.$==0?(b8=b7.$0,true):b7!=null&&b7.$==2&&(b8=b7.$0,true))?{$:1,$0:b8}:null;};x=c.Var=bM.Class({},k,x);x.New=bM.Ctor(function(){k.New.call(this);},x);y=c.View=bM.Class({get_V:function(){return bS.FailWith("View<'T>.V can only be called in an argument to a V-enabled function or if 'T = Doc.");}},null,y);z=c.ConcreteVar=bM.Class({get_Id:function(){return"uinref"+a.String(this.id);},get_View:function(){return this.view;},UpdateMaybe:function(b6){var b7;b7=b6(this.Get());if(b7!=null&&b7.$==1)this.Set(b7.$0);},Update:function(b6){this.Set(b6(this.Get()));},SetFinal:function(b6){if(this.isConst)(function(b7){return b7("WebSharper.UI: invalid attempt to change value of a Var after calling SetFinal");}(function(b7){bO.log(b7);}));else{w.Obsolete(this.snap);this.isConst=true;this.current=b6;this.snap=w.New({$:0,$0:b6});}},Set:function(b6){if(this.isConst)(function(b7){return b7("WebSharper.UI: invalid attempt to change value of a Var after calling SetFinal");}(function(b7){bO.log(b7);}));else{w.Obsolete(this.snap);this.current=b6;this.snap=w.New({$:2,$0:b6,$1:[]});}},Get:function(){return this.current;}},x,z);z.New=bM.Ctor(function(b6,b7,b8){var b9;b9=this;x.New.call(this);this.isConst=b6;this.current=b8;this.snap=b7;this.view=function(){return b9.snap;};this.id=h.Int();},z);A=c.Var$1=bM.Class({},k,A);A.MapLens=function(b6,b7,b8){return y.MapSeqCachedViewBy(b6,function(b9,b_){var b$,ca;function cb(cc){return bN.Equals(b6(cc),b9);}b$=h.Id();return b7((ca=new x({Get:function(){return bL.find(cb,b8.Get());},Set:function(cc){function cd(ce){return cc;}return b8.Update(function(ce){return f.replaceFirst(cb,cd,ce);});},SetFinal:function(cc){return this.Set(cc);},Update:function(cc){return b8.Update(function(cd){return f.replaceFirst(cb,cc,cd);});},UpdateMaybe:function(cc){return b8.Update(function(cd){return f.maybeReplaceFirst(cb,cc,cd);});},get_View:function(){return b_;},get_Id:function(){return b$;}}),(x.New.call(ca),ca)));},b8.get_View());};A.Lens=function(b6,b7,b8){var b9,b_,b$;b9=h.Id();b_=y.Map(b7,b6.get_View());b$=new x({Get:function(){return b7(b6.Get());},Set:function(ca){return b6.Update(function(cb){return b8(cb,ca);});},SetFinal:function(ca){return this.Set(ca);},Update:function(ca){return b6.Update(function(cb){return b8(cb,ca(b7(cb)));});},UpdateMaybe:function(ca){return b6.UpdateMaybe(function(cb){var cc;cc=ca(b7(cb));return cc==null?null:{$:1,$0:b8(cb,cc.$0)};});},get_View:function(){return b_;},get_Id:function(){return b9;}});x.New.call(b$);return b$;};A.Update=function(b6,b7){A.Set(b6,b7(b6.Get()));};A.SetFinal=function(b6,b7){b6.SetFinal(b7);};A.Set=function(b6,b7){b6.Set(b7);};A.CreateWaiting=function(){return new z.New(false,w.New({$:3,$0:[],$1:[]}),null);};A.Create=function(){return new z.New(false,w.New({$:2,$0:null,$1:[]}),null);};A.CreateLogged=function(b6,b7){var b8;if(!self.UINVars)self.UINVars=[];b8=A.Create$1(b7);self.UINVars.push([b6,b8]);return b8;};A.Create$1=function(b6){return new z.New(false,w.New({$:2,$0:b6,$1:[]}),b6);};A.New=bM.Ctor(function(){k.New.call(this);},A);B=c.Updates=bM.Class({set_Value:function(b6){var b7;b7=this.s;if(!(b7===null))w.Obsolete(b7);this.c=b6;}},null,B);B.Create=function(b6){var b7;b7=null;b7=B.New(b6,null,function(){var b8;b8=b7.s;return b8===null?(b8=w.Copy(b7.c()),b7.s=b8,w.WhenObsoleteRun(b8,function(){b7.s=null;}),b8):b8;});return b7;};B.New=function(b6,b7,b8){return new B({c:b6,s:b7,v:b8});};y.get_Do=function(){return D.B;};y.Apply=function(b6,b7){return y.Map2(function(b8,b9){return b8(b9);},b6,b7);};y.AsyncAwait=function(b6,b7){function b8(b9){var b_,b$;function ca(){return y.RemovableSink(function(cb){if(b6(cb)){(bU.Force(b_))();b9(cb);}},b7);}b_=bU.Create(ca);b$=bU.Force(b_);}return bP.FromContinuations(function(b9,b_,b$){return b8.apply(null,[b9,b_,b$]);});};y.RemovableSink=function(b6,b7){var b8;function b9(){w.WhenRun(b7(),function(b_){if(b8[0])b6(b_);},function(){if(b8[0])bP.scheduler().Fork(b9);});}b8=[true];bP.scheduler().Fork(b9);return function(){b8[0]=false;};};y.Sink=function(b6,b7){function b8(){w.WhenRun(b7(),b6,function(){bP.scheduler().Fork(b8);});}bP.scheduler().Fork(b8);};y.TryFinally=function(b6,b7){return y.CreateLazy(function(){try{return b7();}finally{b6();}});};y.TryWith=function(b6,b7){return y.CreateLazy(function(){try{return b7();}catch(b8){return(b6(b8))();}});};y.ConstAsync=function(b6){var b7;b7=w.CreateForeverAsync(b6);return function(){return b7;};};y.Const=function(b6){var b7;b7=w.New({$:0,$0:b6});return function(){return b7;};};y.Sequence=function(b6){return y.CreateLazy(function(){return w.Sequence(bL.map(function(b7){return b7();},b6));});};y.UpdateWhile=function(b6,b7,b8){var b9;b9=[b6];return y.BindInner(function(b_){return b_?y.Map(function(b$){b9[0]=b$;return b$;},b8):y.Const(b9[0]);},b7);};y.BindInner=function(b6,b7){return y.JoinInner(y.Map(b6,b7));};y.JoinInner=function(b6){return y.CreateLazy(function(){return w.JoinInner(b6());});};y.Bind=function(b6,b7){return y.Join(y.Map(b6,b7));};y.Join=function(b6){return y.CreateLazy(function(){return w.Join(b6());});};y.MapSeqCachedView=function(b6,b7){function b8(b9){return b6;}return y.MapSeqCachedViewBy(a.id,function(b9,b_){return(b8(b9))(b_);},b7);};y.MapSeqCachedViewBy=function(b6,b7,b8){var b9;b9=[new bV.New$5()];return y.Map(function(b_){var b$,ca,cb;b$=b9[0];ca=new bV.New$5();cb=d.mapInPlace(function(cc){var cd,ce,cf;cd=b6(cc);ce=b$.ContainsKey(cd)?(cf=b$.Item(cd),(A.Set(cf.r,cc),cf)):y.ConvertSeqNode(function(cg){return b7(cd,cg);},cc);ca.set_Item(cd,ce);return ce.e;},bF.ofSeq(b_));b9[0]=ca;return cb;},b8);};y.ConvertSeqNode=function(b6,b7){var b8,b9;b8=A.Create$1(b7);b9=b8.get_View();return{e:b6(b9),r:b8,w:b9};};y.MapSeqCached=function(b6,b7){return y.MapSeqCachedBy(a.id,b6,b7);};y.MapSeqCachedBy=function(b6,b7,b8){var b9;b9=[new bV.New$5()];return y.Map(function(b_){var b$,ca,cb;b$=b9[0];ca=new bV.New$5();cb=d.mapInPlace(function(cc){var cd,ce;cd=b6(cc);ce=b$.ContainsKey(cd)?b$.Item(cd):b7(cc);ca.set_Item(cd,ce);return ce;},bF.ofSeq(b_));b9[0]=ca;return cb;},b8);};y.SnapshotOn=function(b6,b7,b8){var b9;b9=w.New({$:2,$0:b6,$1:[]});return y.CreateLazy(function(){return b9.s==null?w.SnapshotOn(b7(),b8()):(w.WhenObsolete(b7(),b9),b9);});};y.GetAsync=function(b6){return bP.FromContinuations(function(b7){return y.Get(b7,b6);});};y.WithInitOption=function(b6){return y.CreateLazy(function(){return w.WithInitOption(b6());});};y.WithInit=function(b6,b7){return y.CreateLazy(function(){return w.WithInit(b6,b7());});};y.Get=function(b6,b7){var b8;function b9(){w.WhenRun(b7(),function(b_){if(!b8[0]){b8[0]=true;b6(b_);}},function(){if(!b8[0])b9();});}b8=[false];b9();};y.TryGet=function(b6){return w.TryGet(b6());};y.MapAsync2=function(b6,b7,b8){return y.MapAsync(a.id,y.Map2(b6,b7,b8));};y.MapAsync=function(b6,b7){return y.CreateLazy(function(){return w.MapAsync(b6,b7());});};y.Map3=function(b6,b7,b8,b9){return y.CreateLazy(function(){return w.Map3(b6,b7(),b8(),b9());});};y.Map2Unit=function(b6,b7){return y.CreateLazy(function(){return w.Map2Unit(b6(),b7());});};y.Map2=function(b6,b7,b8){return y.CreateLazy(function(){return w.Map2(b6,b7(),b8());});};y.MapCached=function(b6,b7){return y.MapCachedBy(bN.Equals,b6,b7);};y.MapCachedBy=function(b6,b7,b8){var b9;b9=[null];return y.CreateLazy(function(){return w.MapCachedBy(b6,b9,b7,b8());});};y.Map=function(b6,b7){return y.CreateLazy(function(){return w.Map(b6,b7());});};y.CreateLazy=function(b6){var b7;b7={c:null,o:b6};return function(){var b8,b9;b8=b7.c;return b8===null?(b8=b7.o(),b7.c=b8,(b9=b8.s,b9!=null&&b9.$==0)?b7.o=null:w.WhenObsoleteRun(b8,function(){b7.c=null;}),b8):b8;};};C=c.FromView=bM.Class({get_Id:function(){return"uinref"+a.String(this.id);},SetFinal:function(b6){this.set(b6);},Update:function(b6){var b7;y.Get((b7=this.set,function(b8){return b7(b6(b8));}),this.view);},UpdateMaybe:function(b6){var b7;b7=this;y.Get(function(b8){var b9;b9=b6(b8);if(b9!=null&&b9.$==1)b7.set(b9.$0);},this.view);},Set:function(b6){this.set(b6);},Get:function(){return this.current;},get_View:function(){return this.view;}},x,C);C.New=bM.Ctor(function(b6,b7){var b8,b9;b8=this;x.New.call(this);this.set=b7;this.id=h.Int();this.current=(b9=y.TryGet(b6),b9==null?null:b9.$0);this.view=y.Map(function(b_){b8.current=b_;return b_;},b6);},C);D.B={$:0};E=c.Submitter=bM.Class({Trigger:function(){this["var"].Set(null);}},k,E);E.New=bM.Ctor(function(b6,b7){k.New.call(this);this.input=b6;this["var"]=A.Create();this.view=y.SnapshotOn(b7,this["var"].get_View(),this.input);},E);E.CreateOption=function(b6){return new E.New(y.Map(function(b7){return{$:1,$0:b7};},b6),null);};F.Fresh=function(){return{$:0,$0:h.Int()};};G=c.Model=bM.Class({},k,G);G.New=bM.Ctor(function(b6,b7){var b8;b8=A.Create$1(b7);G.New$1.call(this,b8,y.Map(b6,b8.get_View()));},G);G.New$1=bM.Ctor(function(b6,b7){k.New.call(this);this["var"]=b6;this.view=b7;},G);G.Update=function(b6,b7){A.Update(b7["var"],function(b8){b6(b8);return b8;});};G.Create=function(b6,b7){return new G.New(b6,b7);};H.Default=function(){N.$cctor();return N.Default;};J=I.ArrayStorage=bM.Class({SSet:function(b6){return bF.ofSeq(b6);},SSetAt:function(b6,b7,b8){bF.set(b8,b6,b7);return b8;},SRemoveIf:function(b6,b7){return bF.filter(function(b8){return!b6(b8);},b7);},SInit:function(){return this.init;},SPrependMany:function(b6,b7){var b8;b8=d.ofSeqNonCopying(b6);b7.unshift.apply(b7,b8);return b7;},SPrepend:function(b6,b7){b7.unshift(b6);return b7;},SAppendMany:function(b6,b7){var b8;b8=d.ofSeqNonCopying(b6);b7.push.apply(b7,b8);return b7;},SAppend:function(b6,b7){b7.push(b6);return b7;}},k,J);J.New=bM.Ctor(function(b6){k.New.call(this);this.init=b6;},J);K=I.LocalStorageBackend=bM.Class({clear:function(){this.storage.removeItem(this.id);},set:function(b6){this.storage.setItem(this.id,bW.stringify(bF.map(this.serializer.Encode,b6)));return b6;},SSet:function(b6){return this.set(bF.ofSeq(b6));},SSetAt:function(b6,b7,b8){bF.set(b8,b6,b7);return this.set(b8);},SRemoveIf:function(b6,b7){return this.set(bF.filter(function(b8){return!b6(b8);},b7));},SInit:function(){var b6;b6=this.storage.getItem(this.id);if(b6===null)return[];else try{return bF.map(this.serializer.Decode,bW.parse(b6));}catch(b7){return[];}},SPrependMany:function(b6,b7){var b8;b8=d.ofSeqNonCopying(b6);b7.unshift.apply(b7,b8);return this.set(b7);},SPrepend:function(b6,b7){b7.unshift(b6);return this.set(b7);},SAppendMany:function(b6,b7){var b8;b8=d.ofSeqNonCopying(b6);b7.push.apply(b7,b8);return this.set(b7);},SAppend:function(b6,b7){b7.push(b6);return this.set(b7);}},k,K);K.New=bM.Ctor(function(b6,b7){k.New.call(this);this.id=b6;this.serializer=b7;this.storage=self.localStorage;},K);I.LocalStorage=function(b6,b7){return new K.New(b6,b7);};I.InMemory=function(b6){return new J.New(b6);};L=c.ListModel=bM.Class({Wrap:function(b6,b7,b8){return L.Wrap(this,b6,b7,b8);},MapLens:function(b6){var b7;b7=this;return y.MapSeqCachedViewBy(b7.key,function(b8,b9){return b6(b8,b7["LensInto'"](a.id,function(b_,b$){return b$;},b8,b9));},this["var"].get_View());},Lens:function(b6){return this.LensInto(a.id,function(b7,b8){return b8;},b6);},LensInto:function(b6,b7,b8){return this["LensInto'"](b6,b7,b8,y.Map(b6,this.FindByKeyAsView(b8)));},"LensInto'":function(b6,b7,b8,b9){var b_,b$,ca;b_=this;b$=h.Id();ca=new x({Get:function(){return b6(b_.FindByKey(b8));},Set:function(cb){return b_.UpdateBy(function(cc){return{$:1,$0:b7(cc,cb)};},b8);},SetFinal:function(cb){return this.Set(cb);},Update:function(cb){return b_.UpdateBy(function(cc){return{$:1,$0:b7(cc,cb(b6(cc)))};},b8);},UpdateMaybe:function(cb){return b_.UpdateBy(function(cc){var cd;cd=cb(b6(cc));return cd==null?null:{$:1,$0:b7(cc,cd.$0)};},b8);},get_View:function(){return b9;},get_Id:function(){return b$;}});x.New.call(ca);return ca;},get_LengthAsView:function(){return y.Map(bF.length,this["var"].get_View());},get_Length:function(){return bF.length(this["var"].Get());},Clear:function(){this["var"].Set(this.storage.SSet([]));this.ObsoleteAll();},UpdateBy:function(b6,b7){var b8,b9,b_,b$,ca;b8=this;b9=this["var"].Get();b_=bF.tryFindIndex(function(cb){return bN.Equals(b8.key(cb),b7);},b9);if(b_!=null&&b_.$==1){b$=b_.$0;ca=b6(bF.get(b9,b$));ca!=null&&ca.$==1?(this["var"].Set(this.storage.SSetAt(b$,ca.$0,b9)),this.ObsoleteKey(b7)):void 0;}},UpdateAll:function(b6){var b7;b7=this;this["var"].Update(function(b8){bF.iteri(function(b9,b_){var b$;b$=b6(b_);return b$==null?null:bF.set(b8,b9,b$.$0);},b8);return b7.storage.SSet(b8);});this.ObsoleteAll();},FindByKeyAsView:function(b6){return y.Map(function(b7){return b7.$0;},this.TryFindByKeyAsView(b6));},TryFindByKeyAsView:function(b6){var b7;b7=this;return function(){var b8,b9,b_;b8=(b9=null,[b7.it.TryGetValue(b6,{get:function(){return b9;},set:function(b$){b9=b$;}}),b9]);return b8[0]?b8[1]:(b_=w.New({$:2,$0:b7.TryFindByKey(b6),$1:[]}),(b7.it.DAdd(b6,b_),b_));};},TryFindByKey:function(b6){var b7;b7=this;return bF.tryFind(function(b8){return bN.Equals(b7.key(b8),b6);},this["var"].Get());},FindByKey:function(b6){var b7;b7=this;return bF.find(function(b8){return bN.Equals(b7.key(b8),b6);},this["var"].Get());},TryFindAsView:function(b6){return y.Map(function(b7){return bF.tryFind(b6,b7);},this["var"].get_View());},FindAsView:function(b6){return y.Map(function(b7){return bF.find(b6,b7);},this["var"].get_View());},TryFind:function(b6){return bF.tryFind(b6,this["var"].Get());},Find:function(b6){return bF.find(b6,this["var"].Get());},ContainsKeyAsView:function(b6){var b7;function b8(b9){return bN.Equals(b7.key(b9),b6);}b7=this;return y.Map(function(b9){return bF.exists(b8,b9);},this["var"].get_View());},ContainsKey:function(b6){var b7;b7=this;return bF.exists(function(b8){return bN.Equals(b7.key(b8),b6);},this["var"].Get());},Set:function(b6){this["var"].Set(this.storage.SSet(b6));this.ObsoleteAll();},Iter:function(b6){bF.iter(b6,this["var"].Get());},RemoveByKey:function(b6){var b7;b7=this;this["var"].Set(this.storage.SRemoveIf(function(b8){return bN.Equals(b7.key(b8),b6);},this["var"].Get()));this.ObsoleteKey(b6);},RemoveBy:function(b6){var b7,b8,b9,b_;b7=this["var"].Get();for(b8=0,b9=b7.length-1;b8<=b9;b8++){b_=bF.get(b7,b8);if(b6(b_))this.ObsoleteKey(this.key(b_));}this["var"].Set(this.storage.SRemoveIf(b6,this["var"].Get()));},Remove:function(b6){var b7,b8,b9,b_;b7=this;b8=this["var"].Get();if(M.Contains(b7.key,b6,b8)){b9=b7.key;b_=b9(b6);this["var"].Set(this.storage.SRemoveIf(function(b$){return bN.Equals(b9(b$),b_);},b8));this.ObsoleteKey(b_);}},PrependMany:function(b6){var b7,b8;function b9(b_,b$){var ca,cb;ca=b7.key(b$);b7.ObsoleteKey(ca);cb=bF.tryFindIndex(function(cc){return bN.Equals(b7.key(cc),ca);},b_);return cb==null?(b8.push(b$),b_):b7.storage.SSetAt(cb.$0,b$,b_);}b7=this;b8=bM.MarkResizable([]);this["var"].Set(this.storage.SPrependMany(b8,(((bM.Curried3(bL.fold))(b9))(this["var"].Get()))(b6)));},Prepend:function(b6){var b7,b8,b9,b_;b7=this;b8=this["var"].Get();b9=this.key(b6);b_=bF.tryFindIndex(function(b$){return bN.Equals(b7.key(b$),b9);},b8);if(b_!=null&&b_.$==1)this["var"].Set(this.storage.SSetAt(b_.$0,b6,b8));else this["var"].Set(this.storage.SPrepend(b6,b8));this.ObsoleteKey(b9);},AppendMany:function(b6){var b7,b8;function b9(b_,b$){var ca,cb;ca=b7.key(b$);b7.ObsoleteKey(ca);cb=bF.tryFindIndex(function(cc){return bN.Equals(b7.key(cc),ca);},b_);return cb==null?(b8.push(b$),b_):b7.storage.SSetAt(cb.$0,b$,b_);}b7=this;b8=bM.MarkResizable([]);this["var"].Set(this.storage.SAppendMany(b8,(((bM.Curried3(bL.fold))(b9))(this["var"].Get()))(b6)));},Append:function(b6){var b7,b8,b9,b_;b7=this;b8=this["var"].Get();b9=this.key(b6);b_=bF.tryFindIndex(function(b$){return bN.Equals(b7.key(b$),b9);},b8);if(b_!=null&&b_.$==1)this["var"].Set(this.storage.SSetAt(b_.$0,b6,b8));else this["var"].Set(this.storage.SAppend(b6,b8));this.ObsoleteKey(b9);},ObsoleteAll:function(){bL.iter(function(b6){w.Obsolete(b6.V);},this.it);this.it.Clear();},ObsoleteKey:function(b6){var b7,b8;b7=(b8=null,[this.it.TryGetValue(b6,{get:function(){return b8;},set:function(b9){b8=b9;}}),b8]);if(b7[0]){w.Obsolete(b7[1]);this.it.RemoveKey(b6);}},GetEnumerator0:function(){return bG.Get0(this["var"].Get());},GetEnumerator:function(){return bG.Get(this["var"].Get());}},k,L);L.New=bM.Ctor(function(b6,b7){L.New$3.call(this,b6,A.Create$1(bF.ofSeq(bL.distinctBy(b6,b7.SInit()))),b7);},L);L.New$1=bM.Ctor(function(b6){L.New$2.call(this,b6,[]);},L);L.New$2=bM.Ctor(function(b6,b7){var b8;b8=bF.ofSeq(b7);L.New$3.call(this,b6,A.Create$1(b8),I.InMemory(b8));},L);L.New$3=bM.Ctor(function(b6,b7,b8){k.New.call(this);this.key=b6;this["var"]=b7;this.storage=b8;this.v=y.Map(function(b9){return b9.slice();},this["var"].get_View());this.it=new bV.New$5();},L);M.Contains=function(b6,b7,b8){var b9;b9=b6(b7);return bF.exists(function(b_){return bN.Equals(b6(b_),b9);},b8);};L.Wrap=function(b6,b7,b8,b9){var b_,b$;b_=[new bV.New$5()];b$=bF.map(function(ca){var cb;cb=b8(ca);b_[0].set_Item(b6.key(ca),cb);return cb;},b6["var"].Get());return new L.New$3(function(ca){return b6.key(b7(ca));},A.Lens(b6["var"],function(ca){var cb,cc;cb=new bV.New$5();cc=bF.map(function(cd){var ce,cf;ce=b6.key(cd);cf=b_[0].ContainsKey(ce)?b9(b_[0].Item(ce),cd):b8(cd);cb.set_Item(ce,cf);return cf;},ca);b_[0]=cb;return cc;},function(ca,cb){var cc,cd;cc=new bV.New$5();cd=bF.map(function(ce){var cf;cf=b7(ce);cc.set_Item(b6.key(cf),ce);return cf;},cb);b_[0]=cc;return cd;}),I.InMemory(b$));};L.FromSeq=function(b6){return L.Create(a.id,b6);};L.Create=function(b6,b7){return L.CreateWithStorage(b6,I.InMemory(bF.ofSeq(b7)));};L.CreateWithStorage=function(b6,b7){return new L.New(b6,b7);};N.$cctor=function(){N.$cctor=a.ignore;N.Default={Encode:a.id,Decode:a.id};};O=c.ReactiveExtensions=bM.Class({},k,O);O.New=bM.Ctor(function(){k.New.call(this);},O);P=c.DoubleInterpolation=bM.Class({Interpolate:function(b6,b7,b8){return b7+b6*(b8-b7);}},null,P);P.DoubleInterpolation=new P({$:0});Q.get_Double=function(){return P.DoubleInterpolation;};R=c.Easing=bM.Class({TransformTime:function(b6){return this.transformTime(b6);}},k,R);R.get_CubicInOut=function(){return S.CubicInOut();};R.Custom=function(b6){return new R.New(b6);};R.New=bM.Ctor(function(b6){k.New.call(this);this.transformTime=b6;},R);S.CubicInOut=function(){W.$cctor();return W.CubicInOut;};T.get_Empty=function(){return{$:0,$0:p.Empty()};};T.WhenDone=function(b6,b7){return T.Append({$:0,$0:p.Single({$:0,$0:b6})},b7);};T.Run=function(b6,b7){var b8;function b9(b_){function b$(ca){return function(cb){var cc;cc=cb-ca;b7.Compute(cc);b6();return cc<=b8?void a.requestAnimationFrame(function(cd){(b$(ca))(cd);}):b_();};}a.requestAnimationFrame(function(ca){(b$(ca))(ca);});}b8=b7.Duration;return b8===0?bP.Zero():bP.FromContinuations(function(b_,b$,ca){return b9.apply(null,[b_,b$,ca]);});};T.Play=function(b6){var b7;b7=null;return bP.Delay(function(){return bP.Bind(T.Run(a.ignore,U.Actions(b6)),function(){U.Finalize(b6);return bP.Return(null);});});};T.Pack=function(b6){return{$:0,$0:p.Single({$:1,$0:b6})};};T.Map=function(b6,b7){var b8;return U.Def(b7.Duration,(b8=b7.Compute,function(b9){return b6(b8(b9));}));};T.Delayed=function(b6,b7,b8,b9,b_,b$){return{Compute:function(ca){return ca<=b9?b_:b6.Interpolate(b7.TransformTime((ca-b9)/b8),b_,b$);},Duration:b8+b9};};T.Simple=function(b6,b7,b8,b9,b_){return{Compute:function(b$){return b6.Interpolate(b7.TransformTime(b$/b8),b9,b_);},Duration:b8};};T.Const=function(b6){return U.Const(b6);};T.Concat=function(b6){return{$:0,$0:p.Concat(bL.map(U.List,b6))};};T.Append=function(b6,b7){return{$:0,$0:p.Append(b6.$0,b7.$0)};};T.set_UseAnimations=function(b6){U.set_UseAnimations(b6);};T.get_UseAnimations=function(){return U.UseAnimations();};U.UseAnimations=function(){W.$cctor();return W.UseAnimations;};U.set_UseAnimations=function(b6){W.$cctor();W.UseAnimations=b6;};U.Actions=function(b6){return U.ConcatActions(bF.choose(function(b7){return b7.$==1?{$:1,$0:b7.$0}:null;},p.ToArray(b6.$0)));};U.ConcatActions=function(b6){var b7,b8,b9,b_;b7=d.ofSeqNonCopying(b6);b8=bF.length(b7);return b8===0?U.Const():b8===1?bF.get(b7,0):(b9=bL.max(bL.map(function(b$){return b$.Duration;},b7)),(b_=bF.map(function(b$){return U.Prolong(b9,b$);},b7),U.Def(b9,function(b$){bF.iter(function(ca){ca.Compute(b$);},b_);})));};U.Prolong=function(b6,b7){var b8,b9,b_;b8=b7.Compute;b9=b7.Duration;b_=bU.Create(function(){return b7.Compute(b7.Duration);});return{Compute:function(b$){return b$>=b9?b_.f():b8(b$);},Duration:b6};};U.Const=function(b6){return U.Def(0,function(){return b6;});};U.Def=function(b6,b7){return{Compute:b7,Duration:b6};};U.Finalize=function(b6){bF.iter(function(b7){if(b7.$==0)b7.$0();},p.ToArray(b6.$0));};U.List=function(b6){return b6.$0;};V=c.Trans=bM.Class({Copy:function(b6,b7,b8,b9){var b_,b$,ca,cb,cc;function cd(ce,cf){return b_.TChange(ce,cf);}b_=this;b$=b6==null?function(ce){return function(cf){return cd(ce,cf);};}:b6.$0;return new V.New$3(function(ce,cf){return(b$(ce))(cf);},(ca=this.get_TEnter(),b7==null?ca:b7.$0),(cb=this.get_TExit(),b8==null?cb:b8.$0),(cc=this.get_TFlags(),b9==null?cc:b9.$0));},get_TFlags:function(){return this.flags;},get_TExit:function(){return this.exit;},get_TEnter:function(){return this.enter;},TChange:function(b6,b7){return this.change(b6,b7);}},k,V);V.New=bM.Ctor(function(b6,b7,b8){V.New$3.call(this,b6,bN.Equals(b7,null)?T.Const:b7,bN.Equals(b8,null)?T.Const:b8,1|(bN.Equals(b7,null)?0:2)|(bN.Equals(b8,null)?0:4));},V);V.New$1=bM.Ctor(function(b6){V.New$3.call(this,b6,T.Const,T.Const,1);},V);V.New$2=bM.Ctor(function(){V.New$3.call(this,function(b6,b7){return T.Const(b7);},T.Const,T.Const,0);},V);V.New$3=bM.Ctor(function(b6,b7,b8,b9){k.New.call(this);this.change=b6;this.enter=b7;this.exit=b8;this.flags=b9;},V);V.Exit=function(b6,b7){return b7.Copy(null,null,{$:1,$0:b6},{$:1,$0:b7.get_TFlags()|4});};V.Enter=function(b6,b7){return b7.Copy(null,{$:1,$0:b6},null,{$:1,$0:b7.get_TFlags()|2});};V.Change=function(b6,b7){return b7.Copy({$:1,$0:b6},null,null,{$:1,$0:b7.get_TFlags()|1});};V.Create=function(b6){return new V.New$1(b6);};V.Trivial=function(){return new V.New$2();};V.CanAnimateExit=function(b6){var b7,b8;b7=b6.get_TFlags();b8=4;return(b7&b8)===b8;};V.CanAnimateEnter=function(b6){var b7,b8;b7=b6.get_TFlags();b8=2;return(b7&b8)===b8;};V.CanAnimateChange=function(b6){var b7,b8;b7=b6.get_TFlags();b8=1;return(b7&b8)===b8;};V.AnimateExit=function(b6,b7){return(b6.get_TExit())(b7);};V.AnimateEnter=function(b6,b7){return(b6.get_TEnter())(b7);};V.AnimateChange=function(b6,b7,b8){return b6.TChange(b7,b8);};W.$cctor=function(){W.$cctor=a.ignore;W.CubicInOut=R.Custom(function(b6){var b7;b7=b6*b6;return 3*b7-2*(b7*b6);});W.UseAnimations=true;};Z=c.OnAfterRenderControl=bM.Class({get_Body:function(){var b6,b7,b8,b9,b_,b$,ca;b7=self.document.querySelectorAll("[ws-runafterrender]");for(b8=0,b9=b7.length-1;b8<=b9;b8++){b_=b7[b8];b$=b_.getAttribute("ws-runafterrender");if(b$.indexOf("AfterRenderQ2Client")!=-1){b_.removeAttribute("ws-runafterrender");a["eval"](b$);}else{ca=a["eval"](b$);b_.removeAttribute("ws-runafterrender");ca(b_);}}b6={ReplaceInDom:function(){return null;}};k.New.call(b6);return b6;}},Y,Z);_0=c.AnimatedAttrNode=bM.Class({sync:function(b6){var b7;if(this.dirty){b7=this.logical;if(b7==null);else(this.push(b6))(b7.$0);this.visible=this.logical;this.dirty=false;}},pushVisible:function(b6,b7){this.visible={$:1,$0:b7};this.dirty=true;(this.push(b6))(b7);},NChanged:function(){return this.updates;},NSync:a.ignore,NGetExitAnim:function(b6){var b7,b8;b7=this;return T.WhenDone(function(){b7.dirty=true;b7.visible=null;},(b8=this.visible,b8!=null&&b8.$==1?T.Pack(T.Map(function(b9){b7.pushVisible(b6,b9);},V.AnimateExit(this.tr,b8.$0))):T.get_Empty()));},NGetEnterAnim:function(b6){var b7,b8,b9,b_,b$;b9=this;b_=this.visible;b$=this.logical;switch(b_==null?b$!=null&&b$.$==1?(b8=b$.$0,1):2:b$!=null&&b$.$==1?this.dirty?(b8=[b$.$0,b_.$0],0):2:2){case 0:b7=T.Pack(T.Map(function(ca){b9.pushVisible(b6,ca);},V.AnimateChange(this.tr,b8[1],b8[0])));break;case 1:b7=T.Pack(T.Map(function(ca){b9.pushVisible(b6,ca);},V.AnimateEnter(this.tr,b8)));break;case 2:b7=T.get_Empty();break;}return T.WhenDone(function(){b9.sync(b6);},b7);},NGetChangeAnim:function(b6){var b7,b8,b9,b_;b7=this;return T.WhenDone(function(){b7.sync(b6);},(b8=this.visible,(b9=this.logical,b8!=null&&b8.$==1&&(b9!=null&&b9.$==1&&(this.dirty&&(b_=[b9.$0,b8.$0],true)))?T.Pack(T.Map(function(b$){b7.pushVisible(b6,b$);},V.AnimateChange(this.tr,b_[1],b_[0]))):T.get_Empty())));}},k,_0);_0.New=bM.Ctor(function(b6,b7,b8){var b9;b9=this;k.New.call(this);this.tr=b6;this.push=b8;this.logical=null;this.visible=null;this.dirty=true;this.updates=y.Map(function(b_){b9.logical={$:1,$0:b_};b9.dirty=true;},b7);},_0);_1=c.DynamicAttrNode=bM.Class({NChanged:function(){return this.updates;},NSync:function(b6){if(this.dirty){(this.push(b6))(this.value);this.dirty=false;}},NGetExitAnim:function(b6){return T.get_Empty();},NGetEnterAnim:function(b6){return T.get_Empty();},NGetChangeAnim:function(b6){return T.get_Empty();}},k,_1);_1.New=bM.Ctor(function(b6,b7){var b8;b8=this;k.New.call(this);this.push=b7;this.value=void 0;this.dirty=false;this.updates=y.Map(function(b9){b8.value=b9;b8.dirty=true;},b6);},_1);_2=c.AttrProxy=bM.Class({},null,_2);_2.Handler=function(b6,b7){return _2.HandlerImpl(b6,b7);};_2.HandlerImpl=function(b6,b7){return _6.Static(function(b8){b8.addEventListener(b6,function(b9){return(b7(b8))(b9);},false);});};_2.OnAfterRenderImpl=function(b6){return new _2({$:4,$0:b6});};_2.Concat=function(b6){var b7;b7=d.ofSeqNonCopying(b6);return d.TreeReduce(_6.EmptyAttr(),_2.Append,b7);};_2.Append=function(b6,b7){return _6.AppendTree(b6,b7);};_2.Create=function(b6,b7){return _6.Static(function(b8){b8.setAttribute(b6,b7);});};_5.New=function(b6,b7,b8,b9){var b_;b_={DynElem:b6,DynFlags:b7,DynNodes:b8};bM.SetOptional(b_,"OnAfterRender",b9);return b_;};_6.Static=function(b6){return new _2({$:3,$0:b6});};_6.Dynamic=function(b6,b7){return new _2({$:1,$0:new _1.New(b6,b7)});};_6.Animated=function(b6,b7,b8){var b9,b_,b$;b9=new _0.New(b6,b7,b8);b_=4;if(V.CanAnimateEnter(b6))b_=b_|1;if(V.CanAnimateExit(b6))b_=b_|2;b$=new _2({$:1,$0:b9});_6.SetFlags(b$,b_);return b$;};_6.EmptyAttr=function(){_.$cctor();return _.EmptyAttr;};_6.AppendTree=function(b6,b7){var b8;return b6===null?b7:b7===null?b6:(b8=new _2({$:2,$0:b6,$1:b7}),(_6.SetFlags(b8,_6.Flags(b6)|_6.Flags(b7)),b8));};_6.GetChangeAnim=function(b6){return _6.GetAnim(b6,function(b7,b8){return b7.NGetChangeAnim(b8);});};_6.GetExitAnim=function(b6){return _6.GetAnim(b6,function(b7,b8){return b7.NGetExitAnim(b8);});};_6.GetEnterAnim=function(b6){return _6.GetAnim(b6,function(b7,b8){return b7.NGetEnterAnim(b8);});};_6.GetAnim=function(b6,b7){return T.Concat(bF.map(function(b8){return b7(b8,b6.DynElem);},b6.DynNodes));};_6.Updates=function(b6){return d.MapTreeReduce(function(b7){return b7.NChanged();},y.Const(),y.Map2Unit,b6.DynNodes);};_6.Empty=function(b6){return _5.New(b6,0,[],null);};_6.Insert=function(b6,b7){var b8,b9,b_;function b$(ca){var cb,cc;while(true)if(!(ca===null)){if(ca!=null&&ca.$==1)return b8.push(ca.$0);else if(ca!=null&&ca.$==2){cb=ca.$1;cc=ca.$0;b$(cc);ca=cb;}else return ca!=null&&ca.$==3?ca.$0(b6):ca!=null&&ca.$==4?b9.push(ca.$0):null;}else return null;}b8=[];b9=[];b$(b7);b_=b8.slice(0);return _5.New(b6,_6.Flags(b7),b_,b9.length===0?null:{$:1,$0:function(ca){bL.iter(function(cb){cb(ca);},b9);}});};_6.Sync=function(b6,b7){bF.iter(function(b8){b8.NSync(b6);},b7.DynNodes);};_6.SetFlags=function(b6,b7){b6.flags=b7;};_6.Flags=function(b6){return b6!==null&&b6.hasOwnProperty("flags")?b6.flags:0;};_6.HasExitAnim=function(b6){var b7;b7=2;return(b6.DynFlags&b7)===b7;};_6.HasEnterAnim=function(b6){var b7;b7=1;return(b6.DynFlags&b7)===b7;};_6.HasChangeAnim=function(b6){var b7;b7=4;return(b6.DynFlags&b7)===b7;};_7=c.CheckedInput=bM.Class({get_Input:function(){return this.$==1?this.$0:this.$==2?this.$0:this.$1;}},null,_7);_7.Make=function(b6){var b7;return new _7({$:0,$0:b6,$1:(b7=b6,a.String(b7))});};_8.FloatApplyChecked=function(){_.$cctor();return _.FloatApplyChecked;};_8.FloatGetChecked=function(){_.$cctor();return _.FloatGetChecked;};_8.FloatSetChecked=function(){_.$cctor();return _.FloatSetChecked;};_8.FloatApplyUnchecked=function(){_.$cctor();return _.FloatApplyUnchecked;};_8.FloatGetUnchecked=function(){_.$cctor();return _.FloatGetUnchecked;};_8.FloatSetUnchecked=function(){_.$cctor();return _.FloatSetUnchecked;};_8.IntApplyChecked=function(){_.$cctor();return _.IntApplyChecked;};_8.IntGetChecked=function(){_.$cctor();return _.IntGetChecked;};_8.IntSetChecked=function(){_.$cctor();return _.IntSetChecked;};_8.IntApplyUnchecked=function(){_.$cctor();return _.IntApplyUnchecked;};_8.IntGetUnchecked=function(){_.$cctor();return _.IntGetUnchecked;};_8.IntSetUnchecked=function(){_.$cctor();return _.IntSetUnchecked;};_8.FileApplyUnchecked=function(){_.$cctor();return _.FileApplyUnchecked;};_8.FileGetUnchecked=function(){_.$cctor();return _.FileGetUnchecked;};_8.FileSetUnchecked=function(){_.$cctor();return _.FileSetUnchecked;};_8.DateTimeApplyUnchecked=function(){_.$cctor();return _.DateTimeApplyUnchecked;};_8.DateTimeGetUnchecked=function(){_.$cctor();return _.DateTimeGetUnchecked;};_8.DateTimeSetUnchecked=function(){_.$cctor();return _.DateTimeSetUnchecked;};_8.StringApply=function(){_.$cctor();return _.StringApply;};_8.StringGet=function(){_.$cctor();return _.StringGet;};_8.StringSet=function(){_.$cctor();return _.StringSet;};_8.BoolCheckedApply=function(){_.$cctor();return _.BoolCheckedApply;};_8.FileApplyValue=function(b6,b7,b8){var b9;function b_(b$,ca){return ca==null?null:b$(ca.$0);}b9=null;return[function(b$){b$.addEventListener("change",function(){b8.UpdateMaybe(function(ca){var cb;b9=b6(b$);return b9!=null&&b9.$==1&&(b9.$0!==ca&&(cb=[b9,b9.$0],true))?cb[0]:null;});});},function(b$){var ca;ca=b7(b$);return function(cb){return b_(ca,cb);};},y.Map(function(b$){var ca;return b9!=null&&b9.$==1&&(bN.Equals(b9.$0,b$)&&(ca=b9.$0,true))?null:{$:1,$0:b$};},b8.get_View())];};_8.ApplyValue=function(b6,b7,b8){var b9;function b_(b$,ca){return ca==null?null:b$(ca.$0);}b9=null;return[function(b$){function ca(){b8.UpdateMaybe(function(cb){var cc;b9=b6(b$);return b9!=null&&b9.$==1&&(!bN.Equals(b9.$0,cb)&&(cc=[b9,b9.$0],true))?cc[0]:null;});}b$.addEventListener("change",ca);b$.addEventListener("input",ca);b$.addEventListener("keypress",ca);},function(b$){var ca;ca=b7(b$);return function(cb){return b_(ca,cb);};},y.Map(function(b$){var ca;return b9!=null&&b9.$==1&&(bN.Equals(b9.$0,b$)&&(ca=b9.$0,true))?null:{$:1,$0:b$};},b8.get_View())];};_9.ValidateForm=function(){return _9.OnAfterRender(function(b6){if(self.H5F)self.H5F.setup(b6);});};_9.Checked=function(b6){return _9.ValueWith(_8.BoolCheckedApply(),b6);};_9.FloatValue=function(b6){return _9.ValueWith(_8.FloatApplyChecked(),b6);};_9.FloatValueUnchecked=function(b6){return _9.ValueWith(_8.FloatApplyUnchecked(),b6);};_9.IntValue=function(b6){return _9.ValueWith(_8.IntApplyChecked(),b6);};_9.IntValueUnchecked=function(b6){return _9.ValueWith(_8.IntApplyUnchecked(),b6);};_9.FileValue=function(b6){return _9.ValueWith(_8.FileApplyUnchecked(),b6);};_9.DateTimeValue=function(b6){return _9.ValueWith(_8.DateTimeApplyUnchecked(),b6);};_9.Value=function(b6){return _9.ValueWith(_8.StringApply(),b6);};_9.ContentEditableHtml=function(b6){var b7;b7=_9.CustomVar(b6,function(b8){return function(b9){b8.innerHTML=b9;};},function(b8){return{$:1,$0:b8.innerHTML};});return _2.Append(_2.Create("contenteditable","true"),b7);};_9.ContentEditableText=function(b6){var b7;b7=_9.CustomVar(b6,function(b8){return function(b9){b8.textContent=b9;};},function(b8){return{$:1,$0:b8.textContent};});return _2.Append(_2.Create("contenteditable","true"),b7);};_9.CustomValue=function(b6,b7,b8){return _9.CustomVar(b6,function(b9){return function(b_){b9.value=b7(b_);};},function(b9){return b8(b9.value);});};_9.CustomVar=function(b6,b7,b8){return _9.ValueWith(function(b9){return _8.ApplyValue(b8,b7,b9);},b6);};_9.ValueWith=function(b6,b7){var b8;b8=b6(b7);return _2.Append(_6.Static(b8[0]),_9.DynamicCustom(b8[1],b8[2]));};_9.DynamicProp=function(b6,b7){return _6.Dynamic(b7,function(b8){return function(b9){b8[b6]=b9;};});};_9.Prop=function(b6,b7){return _6.Static(function(b8){b8[b6]=b7;});};_9.DynamicBool=function(b6,b7){function b8(b9,b_){return b_?b9.setAttribute(b6,""):b9.removeAttribute(b6);}return _6.Dynamic(b7,function(b9){return function(b_){return b8(b9,b_);};});};_9.DynamicPred=function(b6,b7,b8){function b9(b_,b$){return b$[0]?b_.setAttribute(b6,b$[1]):b_.removeAttribute(b6);}return _6.Dynamic(y.Map2(function(b_,b$){return[b_,b$];},b7,b8),function(b_){return function(b$){return b9(b_,b$);};});};_9.DynamicClass=function(b6,b7,b8){return _9.DynamicClassPred(b6,y.Map(b8,b7));};_9.Class=function(b6){return _9.ClassPred(b6,true);};_9.ClassPred=function(b6,b7){return _6.Static(function(b8){if(b7)r.AddClass(b8,b6);else r.RemoveClass(b8,b6);});};_9.DynamicClassPred=function(b6,b7){return _6.Dynamic(b7,function(b8){return function(b9){return b9?r.AddClass(b8,b6):r.RemoveClass(b8,b6);};});};_9.OnAfterRenderView=function(b6,b7){var b8;b8=h.Id();return _2.Append(_9.OnAfterRender(function(b9){b7(b9,b9[b8]);}),_9.DynamicCustom(function(b9){return function(b_){b9[b8]=b_;};},b6));};_9.OnAfterRender=function(b6){return new _2({$:4,$0:b6});};_9.HandlerView=function(b6,b7,b8){return _6.Static(function(b9){var b_;b_=b8(b9);b9.addEventListener(b6,function(b$){return y.Get(b_(b$),b7);},false);});};_9.Handler=function(b6,b7){return _6.Static(function(b8){b8.addEventListener(b6,function(b9){return(b7(b8))(b9);},false);});};_9.DynamicStyle=function(b6,b7){return _6.Dynamic(b7,function(b8){return function(b9){return b8.style.setProperty(b6,b9);};});};_9.DynamicCustom=function(b6,b7){return _6.Dynamic(b7,b6);};_9.Dynamic=function(b6,b7){return _6.Dynamic(b7,function(b8){return function(b9){return b8.setAttribute(b6,b9);};});};_9.AnimatedStyle=function(b6,b7,b8,b9){return _6.Animated(b7,b8,function(b_){return function(b$){var ca;ca=b9(b$);return b_.style.setProperty(b6,ca);};});};_9.Animated=function(b6,b7,b8,b9){return _6.Animated(b7,b8,function(b_){return function(b$){return b_.setAttribute(b6,b9(b$));};});};_9.Style=function(b6,b7){return _6.Static(function(b8){b8.style.setProperty(b6,b7);});};_.$cctor=function(){var b6,b7,b8,b9,b_,b$,ca,cb,cc,cd,ce,cf,cg,ch;_.$cctor=a.ignore;_.EmptyAttr=null;_.BoolCheckedApply=function(ci){function cj(ck,cl){return cl!=null&&cl.$==1?void(ck.checked=cl.$0):null;}return[function(ck){ck.addEventListener("change",function(){return!bN.Equals(ci.Get(),ck.checked)?ci.Set(ck.checked):null;});},function(ck){return function(cl){return cj(ck,cl);};},y.Map(function(ck){return{$:1,$0:ck};},ci.get_View())];};_.StringSet=function(ci){return function(cj){ci.value=cj;};};_.StringGet=function(ci){return{$:1,$0:ci.value};};_.StringApply=(b6=_8.StringGet(),(b7=_8.StringSet(),function(ci){return _8.ApplyValue(b6,b7,ci);}));_.DateTimeSetUnchecked=function(ci){return function(cj){ci.value=(new a.Date(cj)).toLocaleString();};};_.DateTimeGetUnchecked=function(ci){var cj,ck,cl,cm;cj=ci.value;return e.isBlank(cj)?{$:1,$0:-8640000000000000}:(ck=(cl=0,[(cm=bX.TryParse(cj),cm!=null&&cm.$==1&&(cl=cm.$0,true)),cl]),ck[0]?{$:1,$0:ck[1]}:null);};_.DateTimeApplyUnchecked=(b8=_8.DateTimeGetUnchecked(),(b9=_8.DateTimeSetUnchecked(),function(ci){return _8.ApplyValue(b8,b9,ci);}));_.FileSetUnchecked=function(){return function(){return null;};};_.FileGetUnchecked=function(ci){var cj;cj=ci.files;return{$:1,$0:bF.ofSeq(bL.delay(function(){return bL.map(function(ck){return cj.item(ck);},bS.range(0,cj.length-1));}))};};_.FileApplyUnchecked=(b_=_8.FileGetUnchecked(),(b$=_8.FileSetUnchecked(),function(ci){return _8.FileApplyValue(b_,b$,ci);}));_.IntSetUnchecked=function(ci){return function(cj){ci.value=a.String(cj);};};_.IntGetUnchecked=function(ci){var cj,ck;cj=ci.value;return e.isBlank(cj)?{$:1,$0:0}:(ck=+cj,ck!==ck>>0?null:{$:1,$0:ck});};_.IntApplyUnchecked=(ca=_8.IntGetUnchecked(),(cb=_8.IntSetUnchecked(),function(ci){return _8.ApplyValue(ca,cb,ci);}));_.IntSetChecked=function(ci){return function(cj){var ck;ck=cj.get_Input();return ci.value!==ck?void(ci.value=ck):null;};};_.IntGetChecked=function(ci){var cj,ck,cl;cj=ci.value;return{$:1,$0:e.isBlank(cj)?(ci.checkValidity?ci.checkValidity():true)?new _7({$:2,$0:cj}):new _7({$:1,$0:cj}):(ck=(cl=0,[bY.TryParseInt32(cj,{get:function(){return cl;},set:function(cm){cl=cm;}}),cl]),ck[0]?new _7({$:0,$0:ck[1],$1:cj}):new _7({$:1,$0:cj}))};};_.IntApplyChecked=(cc=_8.IntGetChecked(),(cd=_8.IntSetChecked(),function(ci){return _8.ApplyValue(cc,cd,ci);}));_.FloatSetUnchecked=function(ci){return function(cj){ci.value=a.String(cj);};};_.FloatGetUnchecked=function(ci){var cj,ck;cj=ci.value;return e.isBlank(cj)?{$:1,$0:0}:(ck=+cj,a.isNaN(ck)?null:{$:1,$0:ck});};_.FloatApplyUnchecked=(ce=_8.FloatGetUnchecked(),(cf=_8.FloatSetUnchecked(),function(ci){return _8.ApplyValue(ce,cf,ci);}));_.FloatSetChecked=function(ci){return function(cj){var ck;ck=cj.get_Input();return ci.value!==ck?void(ci.value=ck):null;};};_.FloatGetChecked=function(ci){var cj,ck;cj=ci.value;return{$:1,$0:e.isBlank(cj)?(ci.checkValidity?ci.checkValidity():true)?new _7({$:2,$0:cj}):new _7({$:1,$0:cj}):(ck=+cj,a.isNaN(ck)?new _7({$:1,$0:cj}):new _7({$:0,$0:ck,$1:cj}))};};_.FloatApplyChecked=(cg=_8.FloatGetChecked(),(ch=_8.FloatSetChecked(),function(ci){return _8.ApplyValue(cg,ch,ci);}));};ba=c.InlineControlWithPlaceHolder=bM.Class({get_Body:function(){return $.prototype.get_Body.call(this);}},$,ba);bb.BatchUpdatesEnabled=function(){bl.$cctor();return bl.BatchUpdatesEnabled;};bb.set_BatchUpdatesEnabled=function(b6){bl.$cctor();bl.BatchUpdatesEnabled=b6;};bc=c.DocElemNode=bM.Class({GetHashCode:function(){return this.ElKey;},Equals:function(b6){return this.ElKey===b6.ElKey;}},null,bc);bc.New=function(b6,b7,b8,b9,b_,b$){var ca;return new bc((ca={Attr:b6,Children:b7,El:b9,ElKey:b_},(bM.SetOptional(ca,"Delimiters",b8),bM.SetOptional(ca,"Render",b$),ca)));};be.FoldBack=function(b6,b7,b8){return bF.foldBack(b6,b7.$0,b8);};be.Iter=function(b6,b7){bF.iter(b6,b7.$0);};be.Except=function(b6,b7){var b8;b8=b6.$0;return{$:0,$0:bF.filter(function(b9){return bF.forall(function(b_){return!(b9===b_);},b8);},b7.$0)};};be.DocChildren=function(b6){var b7;function b8(b9){var b_,b$,ca,cb;while(true){if(b9!=null&&b9.$==2){b$=b9.$0;b9=b$.Current;}else if(b9!=null&&b9.$==1)return b7.push(b9.$0.El);else if(b9==null)return null;else if(b9!=null&&b9.$==5)return b7.push(b9.$0);else if(b9!=null&&b9.$==4)return b7.push(b9.$0.Text);else if(b9!=null&&b9.$==6){b_=b9.$0.Els;return(function(cc){return function(cd){bF.iter(cc,cd);};}(function(cc){if(cc==null||cc.constructor===a.Object)b8(cc);else b7.push(cc);}))(b_);}else{ca=b9.$1;cb=b9.$0;b8(cb);b9=ca;}}}b7=[];b8(b6.Children);return{$:0,$0:d.ofSeqNonCopying(b7)};};be.Children=function(b6,b7){var b8,b9,b_;if(b7!=null&&b7.$==1){b_=[];b8=b7.$0[0].nextSibling;while(b8!==b7.$0[1]){b_.push(b8);b8=b8.nextSibling;}return{$:0,$0:b_};}else return{$:0,$0:bF.init(b6.childNodes.length,(b9=b6.childNodes,function(b$){return b9[b$];}))};};bf.ToArray=function(b6){return i.ToArray(b6.$0);};bf.get_Empty=function(){return{$:0,$0:new bK.New$3()};};bf.IsEmpty=function(b6){return b6.$0.Count()===0;};bf.Intersect=function(b6,b7){return{$:0,$0:i.Intersect(b6.$0,b7.$0)};};bf.Except=function(b6,b7){return{$:0,$0:i.Except(b6.$0,b7.$0)};};bf.FindAll=function(b6){var b7;function b8(b$,ca){var cb,cc,cd,ce,cf;while(true)switch(b$){case 0:if(ca!=null&&ca.$==0){cc=ca.$1;cd=ca.$0;b8(0,cd);ca=cc;}else if(ca!=null&&ca.$==1){ce=ca.$0;ca=ce;b$=1;}else if(ca!=null&&ca.$==2){cf=ca.$0;ca=cf.Current;}else return ca!=null&&ca.$==6?(cb=ca.$0.Holes,(function(cg){return function(ch){bF.iter(cg,ch);};}(b_))(cb)):null;break;case 1:b7.push(ca);ca=ca.Children;b$=0;break;}}function b9(b$){return b8(0,b$);}function b_(b$){return b8(1,b$);}b7=[];b9(b6);return{$:0,$0:new bK.New$2(b7)};};bf.Filter=function(b6,b7){return{$:0,$0:i.Filter(b6,b7.$0)};};bg.New=function(b6,b7){return{PreviousNodes:b6,Top:b7};};bh.UpdateTextNode=function(b6,b7){b6.Value=b7;b6.Dirty=true;};bh.CreateTextNode=function(){return{Text:self.document.createTextNode(""),Dirty:false,Value:""};};bh.UpdateEmbedNode=function(b6,b7){b6.Current=b7;b6.Dirty=true;};bh.CreateEmbedNode=function(){return{Current:null,Dirty:false};};bh.PerformSyncUpdate=function(b6,b7,b8){var b9;b9=bf.FindAll(b8);bh.SyncElemNode(b6,b7.Top);b7.PreviousNodes=b9;};bh.PerformAnimatedUpdate=function(b6,b7,b8){var b9;return T.get_UseAnimations()?(b9=null,bP.Delay(function(){var b_,b$,ca;b_=bf.FindAll(b8);b$=bh.ComputeChangeAnim(b7,b_);ca=bh.ComputeEnterAnim(b7,b_);return bP.Bind(T.Play(T.Append(b$,bh.ComputeExitAnim(b7,b_))),function(){return bP.Bind(bh.SyncElemNodesNextFrame(b6,b7),function(){return bP.Bind(T.Play(ca),function(){b7.PreviousNodes=b_;return bP.Return(null);});});});})):bh.SyncElemNodesNextFrame(b6,b7);};bh.SyncElemNodesNextFrame=function(b6,b7){function b8(b9){a.requestAnimationFrame(function(){bh.SyncElemNode(b6,b7.Top);b9();});}return bb.BatchUpdatesEnabled()?bP.FromContinuations(function(b9,b_,b$){return b8.apply(null,[b9,b_,b$]);}):(bh.SyncElemNode(b6,b7.Top),bP.Return(null));};bh.ComputeEnterAnim=function(b6,b7){return T.Concat(bF.map(function(b8){return _6.GetEnterAnim(b8.Attr);},bf.ToArray(bf.Except(b6.PreviousNodes,bf.Filter(function(b8){return _6.HasEnterAnim(b8.Attr);},b7)))));};bh.ComputeChangeAnim=function(b6,b7){var b8;function b9(b_){return _6.HasChangeAnim(b_.Attr);}b8=function(b_){return bf.Filter(b9,b_);};return T.Concat(bF.map(function(b_){return _6.GetChangeAnim(b_.Attr);},bf.ToArray(bf.Intersect(b8(b6.PreviousNodes),b8(b7)))));};bh.ComputeExitAnim=function(b6,b7){return T.Concat(bF.map(function(b8){return _6.GetExitAnim(b8.Attr);},bf.ToArray(bf.Except(b7,bf.Filter(function(b8){return _6.HasExitAnim(b8.Attr);},b6.PreviousNodes)))));};bh.CreateDelimitedRunState=function(b6,b7,b8){return bg.New(bf.get_Empty(),bh.CreateDelimitedElemNode(b6,b7,_6.EmptyAttr(),b8));};bh.CreateRunState=function(b6,b7){return bg.New(bf.get_Empty(),bh.CreateElemNode(b6,_6.EmptyAttr(),b7));};bh.CreateDelimitedElemNode=function(b6,b7,b8,b9){var b_,b$;b_=b6.parentNode;bh.LinkPrevElement(b7,b9);b$=_6.Insert(b_,b8);return bc.New(b$,b9,{$:1,$0:[b6,b7]},b_,h.Int(),bM.GetOptional(b$.OnAfterRender));};bh.CreateElemNode=function(b6,b7,b8){var b9;bh.LinkElement(b6,b8);b9=_6.Insert(b6,b7);return bc.New(b9,b8,null,b6,h.Int(),bM.GetOptional(b9.OnAfterRender));};bh.SyncElemNode=function(b6,b7){!b6?bh.SyncElement(b7):void 0;bh.Sync(b7.Children);bh.AfterRender(b7);};bh.Sync=function(b6){var b7,b8,b9,b_,b$;while(true){if(b6!=null&&b6.$==1)return bh.SyncElemNode(false,b6.$0);else if(b6!=null&&b6.$==2){b9=b6.$0;b6=b9.Current;}else if(b6==null)return null;else if(b6!=null&&b6.$==5)return null;else if(b6!=null&&b6.$==4){b7=b6.$0;return b7.Dirty?(b7.Text.nodeValue=b7.Value,b7.Dirty=false):null;}else if(b6!=null&&b6.$==6){b8=b6.$0;bF.iter(function(ca){bh.SyncElemNode(false,ca);},b8.Holes);bF.iter(function(ca){_6.Sync(ca[0],ca[1]);},b8.Attrs);return bh.AfterRender(b8);}else{b_=b6.$1;b$=b6.$0;bh.Sync(b$);b6=b_;}}};bh.AfterRender=function(b6){var b7;b7=bM.GetOptional(b6.Render);if(b7!=null&&b7.$==1){b7.$0(b6.El);bM.SetOptional(b6,"Render",null);}};bh.InsertBeforeDelim=function(b6,b7){var b8,b9;b8=b6.parentNode;b9=self.document.createTextNode("");b8.insertBefore(b9,b6);bh.LinkPrevElement(b6,b7);return b9;};bh.LinkPrevElement=function(b6,b7){bh.InsertDoc(b6.parentNode,b7,b6);};bh.LinkElement=function(b6,b7){bh.InsertDoc(b6,b7,null);};bh.SyncElement=function(b6){function b7(b8){function b9(b_){var b$,ca,cb,cc;while(true){if(b_!=null&&b_.$==0){ca=b_.$1;cb=b_.$0;if(b9(cb))return true;else b_=ca;}else if(b_!=null&&b_.$==2){cc=b_.$0;if(cc.Dirty)return true;else b_=cc.Current;}else return b_!=null&&b_.$==6&&(b$=b_.$0,b$.Dirty||bF.exists(b7,b$.Holes));}}return b9(b8.Children);}_6.Sync(b6.El,b6.Attr);if(b7(b6))bh.DoSyncElement(b6);};bh.DoSyncElement=function(b6){var b7,b8,b9;function b_(b$,ca){var cb,cc,cd,ce;while(true){if(b$!=null&&b$.$==1)return b$.$0.El;else if(b$!=null&&b$.$==2){cc=b$.$0;if(cc.Dirty){cc.Dirty=false;return bh.InsertDoc(b7,cc.Current,ca);}else b$=cc.Current;}else if(b$==null)return ca;else if(b$!=null&&b$.$==4)return b$.$0.Text;else if(b$!=null&&b$.$==5)return b$.$0;else if(b$!=null&&b$.$==6){cb=b$.$0;cb.Dirty?cb.Dirty=false:void 0;return bF.foldBack(function(cf,cg){return cf==null||cf.constructor===a.Object?b_(cf,cg):cf;},cb.Els,ca);}else{cd=b$.$1;ce=b$.$0;b$=ce;ca=b_(cd,ca);}}}b7=b6.El;be.Iter((b8=b6.El,function(b$){r.RemoveNode(b8,b$);}),be.Except(be.DocChildren(b6),be.Children(b6.El,bM.GetOptional(b6.Delimiters))));b_(b6.Children,(b9=bM.GetOptional(b6.Delimiters),b9!=null&&b9.$==1?b9.$0[1]:null));};bh.InsertDoc=function(b6,b7,b8){var b9,b_,b$;while(true)if(b7!=null&&b7.$==1)return bh.InsertNode(b6,b7.$0.El,b8);else if(b7!=null&&b7.$==2){b9=b7.$0;b9.Dirty=false;b7=b9.Current;}else if(b7==null)return b8;else if(b7!=null&&b7.$==4)return bh.InsertNode(b6,b7.$0.Text,b8);else if(b7!=null&&b7.$==5)return bh.InsertNode(b6,b7.$0,b8);else if(b7!=null&&b7.$==6)return bF.foldBack(function(ca,cb){return(((bM.Curried3(function(cc,cd,ce){return cd==null||cd.constructor===a.Object?bh.InsertDoc(cc,cd,ce):bh.InsertNode(cc,cd,ce);}))(b6))(ca))(cb);},b7.$0.Els,b8);else{b_=b7.$1;b$=b7.$0;b7=b$;b8=bh.InsertDoc(b6,b_,b8);}};bh.InsertNode=function(b6,b7,b8){r.InsertAt(b6,b8,b7);return b7;};bi=c.Doc=bM.Class({ReplaceInDom:function(b6){var b7;b7=self.document.createTextNode("");b6.parentNode.replaceChild(b7,b6);bi.RunBefore(b7,this);}},k,bi);bi.SvgElementMixed=function(b6,b7){var b8;b8=bi.MixedNodes(b7);return bi.SvgElement(b6,b8[0],b8[1]);};bi.SvgElement=function(b6,b7,b8){var b9,b_;b9=_2.Concat(b7);b_=bi.Concat(b8);return bj.New(self.document.createElementNS("http://www.w3.org/2000/svg",b6),b9,b_);};bi.ElementMixed=function(b6,b7){var b8;b8=bi.MixedNodes(b7);return bi.Element(b6,b8[0],b8[1]);};bi.ConcatMixed=function(b6){return bi.Concat(bL.map(bi.ToMixedDoc,b6));};bi.MixedNodes=function(b6){var b7,b8,b9,b_;b7=bM.MarkResizable([]);b8=bM.MarkResizable([]);b9=bG.Get(b6);try{while(b9.MoveNext()){b_=b9.Current();if(b_ instanceof _2)b7.push(b_);else b8.push(bi.ToMixedDoc(b_));}}finally{if(typeof b9=="object"&&"Dispose"in b9)b9.Dispose();}return[b7,b8];};bi.ToMixedDoc=function(b6){return b6 instanceof bi?b6:typeof b6=="string"?bi.TextNode(b6):b6 instanceof a.Element?bi.StaticProxy(b6):typeof b6=="function"?bi.EmbedView(y.Map(bi.ToMixedDoc,b6)):b6 instanceof x?bi.EmbedView(y.Map(bi.ToMixedDoc,b6.get_View())):bN.Equals(b6,null)?bi.get_Empty():bi.TextNode(a.String(b6));};bi.Element=function(b6,b7,b8){var b9,b_;b9=_2.Concat(b7);b_=bi.Concat(b8);return bj.New(self.document.createElement(b6),b9,b_);};bi.Radio=function(b6,b7,b8){var b9,b_;b9=self.document.createElement("input");b9.addEventListener("click",function(){return b8.Set(b7);},false);b_=_9.DynamicProp("checked",y.Map(function(b$){return bN.Equals(b$,b7);},b8.get_View()));return bj.New(b9,_2.Concat(bE.append(bE.ofArray([_2.Create("type","radio"),_2.Create("name",b8.get_Id()),b_]),bE.ofSeq(b6))),bi.get_Empty());};bi.LinkView=function(b6,b7,b8,b9){var b_;b_=_2.Concat(bL.append([_9.HandlerView("click",b8,function(){return function(){return b9;};}),_2.Create("href","#")],b7));return bj.New(self.document.createElement("a"),b_,bi.TextNode(b6));};bi.Link=function(b6,b7,b8){var b9,b_;b9=(b_=_2.Concat(b7),_2.Append(_2.Create("href","#"),b_));return bj.New(bi.Clickable("a",b8),b9,bi.TextNode(b6));};bi.ButtonView=function(b6,b7,b8,b9){var b_;b_=_2.Concat(bL.append([_9.HandlerView("click",b8,function(){return function(){return b9;};})],b7));return bj.New(self.document.createElement("button"),b_,bi.TextNode(b6));};bi.Button=function(b6,b7,b8){var b9;b9=_2.Concat(b7);return bj.New(bi.Clickable("button",b8),b9,bi.TextNode(b6));};bi.Clickable=function(b6,b7){var b8;b8=self.document.createElement(b6);b8.addEventListener("click",function(b9){b9.preventDefault();return b7();},false);return b8;};bi.CheckBoxGroup=function(b6,b7,b8){function b9(b_){return bN.Equals(b7,b_);}return bi.CheckBox(b6,A.Lens(b8,function(b_){return bE.exists(b9,b_);},function(b_,b$){return b$?bE.exists(function(ca){return bN.Equals(b7,ca);},b_)?b_:new bE.T({$:1,$0:b7,$1:b_}):bE.filter(function(ca){return!bN.Equals(b7,ca);},b_);}));};bi.CheckBox=function(b6,b7){return bi.InputInternal("input",function(){return bL.append(b6,[_2.Create("type","checkbox"),_9.Checked(b7)]);});};bi.SelectDynOptional=function(b6,b7,b8,b9,b_){return bi.SelectDyn(b6,function(b$){return b$!=null&&b$.$==1?b8(b$.$0):b7;},y.Map(function(b$){return new bE.T({$:1,$0:null,$1:bE.map(function(ca){return{$:1,$0:ca};},b$)});},b9),b_);};bi.SelectOptional=function(b6,b7,b8,b9,b_){return bi.Select(b6,function(b$){return b$!=null&&b$.$==1?b8(b$.$0):b7;},new bE.T({$:1,$0:null,$1:bE.map(function(b$){return{$:1,$0:b$};},b9)}),b_);};bi.Select=function(b6,b7,b8,b9){return bi.SelectImpl(b6,b7,function(b_){b_[0]=b8;return bi.Concat(bE.mapi(function(b$,ca){return bi.Element("option",bE.ofArray([_2.Create("value",a.String(b$))]),bE.ofArray([bi.TextNode(b7(ca))]));},b8));},b9);};bi.SelectDyn=function(b6,b7,b8,b9){return bi.SelectImpl(b6,b7,function(b_){function b$(ca,cb){return bi.Element("option",bE.ofArray([_2.Create("value",a.String(ca))]),bE.ofArray([bi.TextNode(b7(cb))]));}return bi.Convert(function(ca){return b$(ca[0],ca[1]);},y.Map(function(ca){b_[0]=ca;return bL.mapi(function(cb,cc){return[cb,cc];},ca);},b8));},b9);};bi.SelectImpl=function(b6,b7,b8,b9){var b_,b$,ca,cb;function cc(ch){return ch.selectedIndex;}function cd(ch,ci){ch.selectedIndex=ci;}function ce(ch){var ci;ci=cc(ch);return b_[0].get_Item(ci);}function cf(ch){return bL.findIndex(function(ci){return bN.Equals(ch,ci);},b_[0]);}function cg(ch,ci){return cd(ch,cf(ci));}b_=[bE.T.Empty];b$=self.document.createElement("select");ca=_9.DynamicCustom(function(ch){return function(ci){return cg(ch,ci);};},b9.get_View());b$.addEventListener("change",function(){b9.UpdateMaybe(function(ch){var ci;ci=ce(b$);return bN.Equals(ch,ci)?null:{$:1,$0:ci};});},false);return bj.New(b$,(cb=_2.Append(ca,_2.Concat(b6)),_2.Append(_9.OnAfterRender(function(ch){cg(ch,b9.Get());}),cb)),b8(b_));};bi.InputArea=function(b6,b7){return bi.InputInternal("textarea",function(){return bL.append(b6,[_9.Value(b7)]);});};bi.RangeInput=function(b6,b7){return bi.InputInternal("input",function(){return bL.append(b6,[_9.IntValueUnchecked(b7),_2.Create("type","range")]);});};bi.WeekInput=function(b6,b7){return bi.InputInternal("input",function(){return bL.append(b6,[_9.Value(b7),_2.Create("type","week")]);});};bi.UrlInput=function(b6,b7){return bi.InputInternal("input",function(){return bL.append(b6,[_9.Value(b7),_2.Create("type","url")]);});};bi.TimeInput=function(b6,b7){return bi.InputInternal("input",function(){return bL.append(b6,[_9.Value(b7),_2.Create("type","time")]);});};bi.TelInput=function(b6,b7){return bi.InputInternal("input",function(){return bL.append(b6,[_9.Value(b7),_2.Create("type","tel")]);});};bi.SearchInput=function(b6,b7){return bi.InputInternal("input",function(){return bL.append(b6,[_9.Value(b7),_2.Create("type","search")]);});};bi.MonthInput=function(b6,b7){return bi.InputInternal("input",function(){return bL.append(b6,[_9.Value(b7),_2.Create("type","month")]);});};bi.FileInput=function(b6,b7){return bi.InputInternal("input",function(){return bL.append(b6,[_9.FileValue(b7),_2.Create("type","file")]);});};bi.EmailInput=function(b6,b7){return bi.InputInternal("input",function(){return bL.append(b6,[_9.Value(b7),_2.Create("type","email")]);});};bi.DateTimeLocalInput=function(b6,b7){return bi.InputInternal("input",function(){return bL.append(b6,[_9.DateTimeValue(b7),_2.Create("type","datetime-local")]);});};bi.DateInput=function(b6,b7){return bi.InputInternal("input",function(){return bL.append(b6,[_9.Value(b7),_2.Create("type","datetime")]);});};bi.ColorInput=function(b6,b7){return bi.InputInternal("input",function(){return bL.append(b6,[_9.Value(b7),_2.Create("type","color")]);});};bi.FloatInput=function(b6,b7){return bi.InputInternal("input",function(){return bL.append(b6,[_9.FloatValue(b7),_2.Create("type","number")]);});};bi.FloatInputUnchecked=function(b6,b7){return bi.InputInternal("input",function(){return bL.append(b6,[b7.Get()===0?_2.Create("value","0"):_6.EmptyAttr(),_9.FloatValueUnchecked(b7),_2.Create("type","number")]);});};bi.IntInput=function(b6,b7){return bi.InputInternal("input",function(){return bL.append(b6,[_9.IntValue(b7),_2.Create("type","number")]);});};bi.IntInputUnchecked=function(b6,b7){return bi.InputInternal("input",function(){return bL.append(b6,[b7.Get()===0?_2.Create("value","0"):_6.EmptyAttr(),_9.IntValueUnchecked(b7),_2.Create("type","number")]);});};bi.PasswordBox=function(b6,b7){return bi.InputInternal("input",function(){return bL.append(b6,[_9.Value(b7),_2.Create("type","password")]);});};bi.Input=function(b6,b7){return bi.InputInternal("input",function(){return bL.append(b6,[_9.Value(b7)]);});};bi.InputInternal=function(b6,b7){var b8;b8=self.document.createElement(b6);return bj.New(b8,_2.Concat(b7(b8)),bi.get_Empty());};bi.ConvertSeqVarBy=function(b6,b7,b8){return bi.Flatten(A.MapLens(b6,b7,b8));};bi.ConvertSeqBy=function(b6,b7,b8){return bi.Flatten(y.MapSeqCachedViewBy(b6,function(b9,b_){return(b7(b9))(b_);},b8));};bi.ConvertSeq=function(b6,b7){return bi.Flatten(y.MapSeqCachedView(b6,b7));};bi.ConvertBy=function(b6,b7,b8){return bi.Flatten(y.MapSeqCachedBy(b6,b7,b8));};bi.Convert=function(b6,b7){return bi.Flatten(y.MapSeqCached(b6,b7));};bi.Flatten=function(b6){return bi.EmbedView(y.Map(bi.Concat,b6));};bi.TextView=function(b6){var b7;b7=bh.CreateTextNode();return bi.Mk({$:4,$0:b7},y.Map(function(b8){bh.UpdateTextNode(b7,b8);},b6));};bi.RunReplaceById=function(b6,b7){var b8;b8=self.document.getElementById(b6);if(bN.Equals(b8,null))bS.FailWith("invalid id: "+b6);else b7.ReplaceInDom(b8);};bi.RunById=function(b6,b7){var b8;b8=self.document.getElementById(b6);if(bN.Equals(b8,null))bS.FailWith("invalid id: "+b6);else bi.Run(b8,b7);};bi.Run=function(b6,b7){bh.LinkElement(b6,b7.docNode);bi.RunInPlace(false,b6,b7);};bi.RunInPlace=function(b6,b7,b8){var b9;b9=bh.CreateRunState(b7,b8.docNode);y.Sink(T.get_UseAnimations()||bb.BatchUpdatesEnabled()?n.StartProcessor(bh.PerformAnimatedUpdate(b6,b9,b8.docNode)):function(){bh.PerformSyncUpdate(b6,b9,b8.docNode);},b8.updates);};bi.RunPrependById=function(b6,b7){var b8;b8=self.document.getElementById(b6);if(bN.Equals(b8,null))bS.FailWith("invalid id: "+b6);else bi.RunPrepend(b8,b7);};bi.RunPrepend=function(b6,b7){var b8;b8=self.document.createTextNode("");b6.insertBefore(b8,b6.firstChild);bi.RunBefore(b8,b7);};bi.RunAppendById=function(b6,b7){var b8;b8=self.document.getElementById(b6);if(bN.Equals(b8,null))bS.FailWith("invalid id: "+b6);else bi.RunAppend(b8,b7);};bi.RunAppend=function(b6,b7){var b8;b8=self.document.createTextNode("");b6.appendChild(b8);bi.RunBefore(b8,b7);};bi.RunAfterById=function(b6,b7){var b8;b8=self.document.getElementById(b6);if(bN.Equals(b8,null))bS.FailWith("invalid id: "+b6);else bi.RunAfter(b8,b7);};bi.RunAfter=function(b6,b7){var b8;b8=self.document.createTextNode("");b6.parentNode.insertBefore(b8,b6.nextSibling);bi.RunBetween(b6,b8,b7);};bi.RunBeforeById=function(b6,b7){var b8;b8=self.document.getElementById(b6);if(bN.Equals(b8,null))bS.FailWith("invalid id: "+b6);else bi.RunBefore(b8,b7);};bi.RunBefore=function(b6,b7){var b8;b8=self.document.createTextNode("");b6.parentNode.insertBefore(b8,b6);bi.RunBetween(b8,b6,b7);};bi.RunBetween=function(b6,b7,b8){var b9;bh.LinkPrevElement(b7,b8.docNode);b9=bh.CreateDelimitedRunState(b6,b7,b8.docNode);y.Sink(T.get_UseAnimations()||bb.BatchUpdatesEnabled()?n.StartProcessor(bh.PerformAnimatedUpdate(false,b9,b8.docNode)):function(){bh.PerformSyncUpdate(false,b9,b8.docNode);},b8.updates);};bi.Async=function(b6){return bi.EmbedView(y.MapAsync(a.id,y.Const(b6)));};bi.BindView=function(b6,b7){return bi.EmbedView(y.Map(b6,b7));};bi.EmbedView=function(b6){var b7;b7=bh.CreateEmbedNode();return bi.Mk({$:2,$0:b7},y.Map(a.ignore,y.Bind(function(b8){bh.UpdateEmbedNode(b7,b8.docNode);return b8.updates;},b6)));};bi.Verbatim=function(b6){return bi.Mk(d.MapTreeReduce(function(b7){return bN.Equals(b7.nodeType,bZ.TEXT_NODE)?{$:5,$0:b7}:{$:1,$0:bh.CreateElemNode(b7,_6.EmptyAttr(),null)};},null,function(b7,b8){return{$:0,$0:b7,$1:b8};},r.ChildrenArray(r.ParseHTMLIntoFakeRoot(b6))),y.Const());};bi.StaticProxy=function(b6){return bj.New(b6,_6.EmptyAttr(),bi.get_Empty());};bi.TextNode=function(b6){return bi.Mk({$:5,$0:self.document.createTextNode(b6)},y.Const());};bi.get_Empty=function(){return bi.Mk(null,y.Const());};bi.Concat=function(b6){var b7;b7=d.ofSeqNonCopying(b6);return d.TreeReduce(bi.get_Empty(),bi.Append,b7);};bi.Append=function(b6,b7){return bi.Mk({$:0,$0:b6.docNode,$1:b7.docNode},y.Map2Unit(b6.updates,b7.updates));};bi.Mk=function(b6,b7){return new bi.New(b6,b7);};bi.New=bM.Ctor(function(b6,b7){k.New.call(this);this.docNode=b6;this.updates=b7;},bi);bj=c.Elt=bM.Class({SetStyle:function(b6,b7){this.elt.style[b6]=b7;},HasClass:function(b6){return(new a.RegExp("(\\s|^)"+b6+"(\\s|$)")).test(this.elt.className);},GetProperty:function(b6){return this.elt[b6];},SetProperty:function(b6,b7){this.elt[b6]=b7;},RemoveAttribute:function(b6){this.elt.removeAttribute(b6);},HasAttribute:function(b6){return this.elt.hasAttribute(b6);},GetAttribute:function(b6){return this.elt.getAttribute(b6);},SetAttribute:function(b6,b7){this.elt.setAttribute(b6,b7);},SetText:function(b6){var b7;b7=this.docNode$1;if(b7!=null&&b7.$==1)b7.$0.Children=null;else b7!=null&&b7.$==6?(b7.$0.Els=[],this.ClearHoles()):bS.FailWith("Invalid docNode in Elt");this.rvUpdates.set_Value(y.Const());this.elt.textContent=b6;},GetText:function(){return this.elt.textContent;},SetValue:function(b6){this.elt.value=b6;},GetValue:function(){return this.elt.value;},Id:function(){return this.elt.id;},Html:function(){return this.elt.outerHTML;},Clear:function(){var b6;b6=this.docNode$1;if(b6!=null&&b6.$==1)b6.$0.Children=null;else b6!=null&&b6.$==6?(b6.$0.Els=[],this.ClearHoles()):bS.FailWith("Invalid docNode in Elt");this.rvUpdates.set_Value(y.Const());while(this.elt.hasChildNodes())this.elt.removeChild(this.elt.firstChild);},Prepend:function(b6){var b7,b8,b9,b_,b$;b7=this.docNode$1;if(b7!=null&&b7.$==1){b8=b7.$0;b8.Children={$:0,$0:b6.docNode,$1:b8.Children};bh.InsertDoc(this.elt,b6.docNode,(b9=this.elt.firstChild,bN.Equals(b9,null)?null:b9));}else b7!=null&&b7.$==6?(b_=this.elt.insertBefore(self.document.createTextNode(""),this.elt.firstChild),b$=bh.InsertBeforeDelim(b_,b6.docNode),this.AddHole(bc.New(_6.Empty(this.elt),b6.docNode,{$:1,$0:[b$,b_]},this.elt,h.Int(),null))):bS.FailWith("Invalid docNode in Elt");this.rvUpdates.set_Value(y.Map2Unit(this.rvUpdates.c,b6.updates));},Append:function(b6){var b7,b8,b9,b_;b7=this.docNode$1;if(b7!=null&&b7.$==1){b8=b7.$0;b8.Children={$:0,$0:b8.Children,$1:b6.docNode};bh.InsertDoc(this.elt,b6.docNode,null);}else b7!=null&&b7.$==6?(b9=this.elt.appendChild(self.document.createTextNode("")),b_=bh.InsertBeforeDelim(b9,b6.docNode),this.AddHole(bc.New(_6.Empty(this.elt),b6.docNode,{$:1,$0:[b_,b9]},this.elt,h.Int(),null))):bS.FailWith("Invalid docNode in Elt");this.rvUpdates.set_Value(y.Map2Unit(this.rvUpdates.c,b6.updates));},ToUpdater:function(){var b6,b7,b8;return new bk.New((b6=this.docNode$1,b6!=null&&b6.$==1?bM.DeleteEmptyFields({Els:[this.elt],Dirty:true,Holes:[],Attrs:[[this.elt,b6.$0.Attr]],Render:(b7=null,b7?b7.$0:void 0),El:(b8={$:1,$0:this.elt},b8?b8.$0:void 0)},["Render","El"]):b6!=null&&b6.$==6?b6.$0:bS.FailWith("Invalid docNode in Elt")),this.updates$1,this.elt,this.rvUpdates,A.Create$1([]));},OnAfterRenderView:function(b6,b7){var b8,b9;b8=this;b9=h.Id();this.Append(bi.BindView(function(b_){b8.elt[b9]=b_;return bi.get_Empty();},b6));return this["OnAfterRender'"](function(b_){b7(b_,b_[b9]);});},OnAfterRender:function(b6){return this["OnAfterRender'"](b6);},"OnAfterRender'":function(b6){var b7,b8,b9,b_,b$,ca,cb;b7=this.docNode$1;if(b7!=null&&b7.$==1){b8=b7.$0;bM.SetOptional(b8,"Render",(b9=bM.GetOptional(b8.Render),b9!=null&&b9.$==1?(b_=b9.$0,{$:1,$0:function(cc){b_(cc);b6(cc);}}):{$:1,$0:b6}));}else b7!=null&&b7.$==6?(b$=b7.$0,bM.SetOptional(b$,"Render",(ca=bM.GetOptional(b$.Render),ca!=null&&ca.$==1?(cb=ca.$0,{$:1,$0:function(cc){cb(cc);b6(cc);}}):{$:1,$0:b6}))):bS.FailWith("Invalid docNode in Elt");return this;},onView:function(b6,b7,b8){var b9;b9=b8(this.elt);this.elt.addEventListener(b6,function(b_){return y.Get(b9(b_),b7);},false);return this;},on:function(b6,b7){var b8;b8=this;this.elt.addEventListener(b6,function(b9){return b7(b8.elt,b9);},false);return this;},ClearHoles:function(){var b6;b6=this.docNode$1;if(b6!=null&&b6.$==6)b6.$0.Holes=[];},AddHole:function(b6){var b7;b7=this.docNode$1;if(b7!=null&&b7.$==6)b7.$0.Holes.push(b6);}},bi,bj);bj.TreeNode=function(b6,b7){var b8,b9;function b_(b$,ca){return _6.Updates(ca);}b8=B.Create(b7);return new bj.New$1({$:6,$0:b6},y.Map2Unit((b9=bF.map(function(b$){return b_(b$[0],b$[1]);},b6.Attrs),d.TreeReduce(y.Const(),y.Map2Unit,b9)),b8.v),bF.get(b6.Els,0),b8);};bj.New=function(b6,b7,b8){var b9,b_;b9=bh.CreateElemNode(b6,b7,b8.docNode);b_=B.Create(b8.updates);return new bj.New$1({$:1,$0:b9},y.Map2Unit(_6.Updates(b9.Attr),b_.v),b6,b_);};bj.New$1=bM.Ctor(function(b6,b7,b8,b9){bi.New.call(this,b6,b7);this.docNode$1=b6;this.updates$1=b7;this.elt=b8;this.rvUpdates=b9;},bj);bk=_3.EltUpdater=bM.Class({ClearHoles:function(){this.origHoles=[];this.treeNode.Holes=[];this.holeUpdates.Set([]);},AddHole:function(b6){this.origHoles.push(b6);this.treeNode.Holes=this.treeNode.Holes.concat([b6]);},RemoveAllUpdated:function(){this.treeNode.Holes=this.origHoles;this.holeUpdates.Set([]);},RemoveUpdated:function(b6){var b7,b8;function b9(b_){return b_!==b8;}b7=b6.docNode;if(b7!=null&&b7.$==1){b8=b7.$0.ElKey;this.treeNode.Holes=bF.filter(function(b_){return b_.ElKey!==b8;},this.treeNode.Holes);this.holeUpdates.Set(bF.filter(function(b_){return b9(b_[0]);},this.holeUpdates.Get()));}else bS.FailWith("DocUpdater.RemoveUpdated expects a single element node");},AddUpdated:function(b6){var b7,b8,b9;b7=b6.docNode;if(b7!=null&&b7.$==1){b8=b7.$0;this.treeNode.Holes=this.treeNode.Holes.concat([b8]);b9=this.holeUpdates.Get();b9.push([b8.ElKey,b6.updates]);this.holeUpdates.Set(b9);}else bS.FailWith("DocUpdater.AddUpdated expects a single element node");}},bj,bk);bk.New=bM.Ctor(function(b6,b7,b8,b9,b_){var b$,ca,cb,cc;function cd(ce){return ce[1];}bj.New$1.call(this,{$:6,$0:b6},y.Map2Unit(b7,(b$=b_.get_View(),y.BindInner((ca=function(ce){return bF.map(cd,ce);},(cb=(cc=y.Const(),function(ce){return d.TreeReduce(cc,y.Map2Unit,ce);}),function(ce){return cb(ca(ce));})),b$))),b8,b9);this.treeNode=b6;this.holeUpdates=b_;this.origHoles=this.treeNode.Holes;},bk);bl.$cctor=function(){bl.$cctor=a.ignore;bl.BatchUpdatesEnabled=true;};bn.failNotLoaded=function(b6){bO.warn("Instantiating non-loaded template",b6);};bn.fill=function(b6,b7,b8){while(true)if(b6.hasChildNodes())b8=b7.insertBefore(b6.lastChild,b8);else return null;};bn.fillTextHole=function(b6,b7,b8){var b9;b9=b6.querySelector("[ws-replace]");return bN.Equals(b9,null)?(bO.warn("Filling non-existent text hole",b8),null):(b9.parentNode.replaceChild(self.document.createTextNode(b7),b9),{$:1,$0:b9.getAttribute("ws-replace")});};bn.removeHolesExcept=function(b6,b7){function b8(b9){bm.foreachNotPreserved(b6,"["+b9+"]",function(b_){if(!b7.Contains(b_.getAttribute(b9)))b_.removeAttribute(b9);});}b8("ws-attr");b8("ws-onafterrender");b8("ws-var");bm.foreachNotPreserved(b6,"[ws-hole]",function(b9){if(!b7.Contains(b9.getAttribute("ws-hole"))){b9.removeAttribute("ws-hole");while(b9.hasChildNodes())b9.removeChild(b9.lastChild);}});bm.foreachNotPreserved(b6,"[ws-replace]",function(b9){if(!b7.Contains(b9.getAttribute("ws-replace")))b9.parentNode.removeChild(b9);});bm.foreachNotPreserved(b6,"[ws-on]",function(b9){b9.setAttribute("ws-on",bH.concat(" ",bF.filter(function(b_){return b7.Contains(bF.get(bH.SplitChars(b_,[":"],1),1));},bH.SplitChars(b9.getAttribute("ws-on"),[" "],1))));});bm.foreachNotPreserved(b6,"[ws-attr-holes]",function(b9){var b_,b$,ca,cb,cc;b_=bH.SplitChars(b9.getAttribute("ws-attr-holes"),[" "],1);for(b$=0,ca=b_.length-1;b$<=ca;b$++){cb=bF.get(b_,b$);b9.setAttribute(cb,(cc=new a.RegExp(bm.TextHoleRE(),"g"),b9.getAttribute(cb).replace(cc,function(cd,ce){return b7.Contains(ce)?cd:"";})));}});};bn.fillInstanceAttrs=function(b6,b7){var b8,b9,b_,b$,ca;bn.convertAttrs(b7);b8=b7.nodeName.toLowerCase();b9=b6.querySelector("[ws-attr="+b8+"]");if(bN.Equals(b9,null))bO.warn("Filling non-existent attr hole",b8);else{b9.removeAttribute("ws-attr");for(b_=0,b$=b7.attributes.length-1;b_<=b$;b_++){ca=b7.attributes.item(b_);if(ca.name==="class"&&b9.hasAttribute("class"))b9.setAttribute("class",b9.getAttribute("class")+" "+ca.nodeValue);else b9.setAttribute(ca.name,ca.nodeValue);}}};bn.mapHoles=function(b6,b7){function b8(b9){bm.foreachNotPreserved(b6,"["+b9+"]",function(b_){var b$,ca;b$=(ca=null,[b7.TryGetValue(b_.getAttribute(b9).toLowerCase(),{get:function(){return ca;},set:function(cb){ca=cb;}}),ca]);if(b$[0])b_.setAttribute(b9,b$[1]);});}b8("ws-hole");b8("ws-replace");b8("ws-attr");b8("ws-onafterrender");b8("ws-var");bm.foreachNotPreserved(b6,"[ws-on]",function(b9){b9.setAttribute("ws-on",bH.concat(" ",bF.map(function(b_){var b$,ca,cb;b$=bH.SplitChars(b_,[":"],1);ca=(cb=null,[b7.TryGetValue(bF.get(b$,1),{get:function(){return cb;},set:function(cc){cb=cc;}}),cb]);return ca[0]?bF.get(b$,0)+":"+ca[1]:b_;},bH.SplitChars(b9.getAttribute("ws-on"),[" "],1))));});bm.foreachNotPreserved(b6,"[ws-attr-holes]",function(b9){var b_,b$,ca;b_=bH.SplitChars(b9.getAttribute("ws-attr-holes"),[" "],1);for(b$=0,ca=b_.length-1;b$<=ca;b$++)(function(){var cb;function cc(cd,ce){var cf;cf=bS.KeyValue(ce);return cd.replace(new a.RegExp("\\${"+cf[0]+"}","ig"),"${"+cf[1]+"}");}cb=bF.get(b_,b$);return b9.setAttribute(cb,(((bM.Curried3(bL.fold))(cc))(b9.getAttribute(cb)))(b7));}());});};bn.convertTextNode=function(b6){var b7,b8,b9,b_,b$,ca;b7=null;b8=0;b_=b6.textContent;b$=new a.RegExp(bm.TextHoleRE(),"g");while(b7=b$.exec(b_),b7!==null){b6.parentNode.insertBefore(self.document.createTextNode(b0.string(b_,{$:1,$0:b8},{$:1,$0:b$.lastIndex-bF.get(b7,0).length-1})),b6);b8=b$.lastIndex;ca=self.document.createElement("span");ca.setAttribute("ws-replace",bF.get(b7,1).toLowerCase());b6.parentNode.insertBefore(ca,b6);}b$.lastIndex=0;b6.textContent=b0.string(b_,{$:1,$0:b8},null);};bn.convertAttrs=function(b6){var b8,b9,b_,b$,ca,cb,cc,cd;function b7(ce){var cf;cf=b6.getAttribute(ce);if(cf===null);else b6.setAttribute(ce,cf.toLowerCase());}b8=b6.attributes;b9=[];b_=[];b$=[];for(ca=0,cb=b8.length-1;ca<=cb;ca++){cc=b8.item(ca);if(bH.StartsWith(cc.nodeName,"ws-on")&&cc.nodeName!=="ws-onafterrender"&&cc.nodeName!=="ws-on"){b9.push(cc.nodeName);b_.push(b0.string(cc.nodeName,{$:1,$0:"ws-on".length},null)+":"+cc.nodeValue.toLowerCase());}else!bH.StartsWith(cc.nodeName,"ws-")&&(new a.RegExp(bm.TextHoleRE())).test(cc.nodeValue)?(cc.nodeValue=(cd=new a.RegExp(bm.TextHoleRE(),"g"),cc.nodeValue.replace(cd,function(ce,cf){return"${"+cf.toLowerCase()+"}";})),b$.push(cc.nodeName)):void 0;}if(!(b_.length==0))b6.setAttribute("ws-on",bH.concat(" ",b_));if(!(b$.length==0))b6.setAttribute("ws-attr-holes",bH.concat(" ",b$));b7("ws-hole");b7("ws-replace");b7("ws-attr");b7("ws-onafterrender");b7("ws-var");bF.iter(function(ce){b6.removeAttribute(ce);},b9);};bm.GetOrLoadTemplate=function(b6,b7,b8,b9){bm.LoadLocalTemplates("");bm.PrepareTemplate(b6,b7,b8);return bm.NamedTemplate(b6,b7,b9);};bm.NamedTemplate=function(b6,b7,b8){var b9,b_;b9=(b_=null,[bm.LoadedTemplateFile(b6).TryGetValue(b7==null?"":b7.$0,{get:function(){return b_;},set:function(b$){b_=b$;}}),b_]);return b9[0]?bm.ChildrenTemplate(b9[1].cloneNode(true),b8):(bO.warn("Local template doesn't exist",b7),bi.get_Empty());};bm.RunFullDocTemplate=function(b6){var b7,b8,b9;return bm.RenderedFullDocTemplate()==null?(b7=(bm.LoadLocalTemplates(""),bm.PrepareTemplateStrict("",null,self.document.body,null),b8=bm.ChildrenTemplate(self.document.body,b6),b9=self.document.body,function(b_){bi.RunInPlace(true,b9,b_);}(b8),b8),(bm.set_RenderedFullDocTemplate({$:1,$0:b7}),b7)):bm.RenderedFullDocTemplate().$0;};bm.RenderedFullDocTemplate=function(){bo.$cctor();return bo.RenderedFullDocTemplate;};bm.set_RenderedFullDocTemplate=function(b6){bo.$cctor();bo.RenderedFullDocTemplate=b6;};bm.LoadLocalTemplates=function(b6){!bm.LocalTemplatesLoaded()?(bm.set_LocalTemplatesLoaded(true),bm.LoadNestedTemplates(self.document.body,"")):void 0;bm.LoadedTemplates().set_Item(b6,bm.LoadedTemplateFile(""));};bm.LoadNestedTemplates=function(b6,b7){var b9,b_,b$,ca,cb,cc,cd,ce,cf,cg,ch,ci,cj,ck,cl,cm,cn,co,cp,cq,cr;function b8(cs){var ct,cu;if(!b9.ContainsKey(cs)){ct=(cu=null,[b_.TryGetValue(cs,{get:function(){return cu;},set:function(cv){cu=cv;}}),cu]);if(ct[0]){cr.SAdd(cs);b_.RemoveKey(cs);bm.PrepareTemplateStrict(b7,{$:1,$0:cs},ct[1],{$:1,$0:b8});}else bO.warn(cr.Contains(cs)?"Encountered loop when instantiating "+cs:"Local template does not exist: "+cs);}}b9=bm.LoadedTemplateFile(b7);b_=new bV.New$5();b$=b6.querySelectorAll("[ws-template]");for(ca=0,cb=b$.length-1;ca<=cb;ca++){cc=b$[ca];cd=cc.getAttribute("ws-template").toLowerCase();cc.removeAttribute("ws-template");b_.set_Item(cd,bm.FakeRootSingle(cc));}ce=b6.querySelectorAll("[ws-children-template]");for(cf=0,cg=ce.length-1;cf<=cg;cf++){ch=ce[cf];ci=ch.getAttribute("ws-children-template").toLowerCase();ch.removeAttribute("ws-children-template");b_.set_Item(ci,bm.FakeRoot(ch));}cj=b6.querySelectorAll("template[id]");for(ck=0,cl=cj.length-1;ck<=cl;ck++){cm=cj[ck];b_.set_Item(cm.getAttribute("id").toLowerCase(),bm.FakeRootFromHTMLTemplate(cm));}cn=b6.querySelectorAll("template[name]");for(co=0,cp=cn.length-1;co<=cp;co++){cq=cn[co];b_.set_Item(cq.getAttribute("name").toLowerCase(),bm.FakeRootFromHTMLTemplate(cq));}cr=new bK.New$3();while(b_.count>0)b8(bL.head(b_.Keys()));};bm.PrepareTemplate=function(b6,b7,b8){if(!bm.LoadedTemplateFile(b6).ContainsKey(b7==null?"":b7.$0))bm.PrepareTemplateStrict(b6,b7,b8(),null);};bm.PrepareSingleTemplate=function(b6,b7,b8){var b9;b9=bm.FakeRootSingle(b8);return function(b_){bm.PrepareTemplateStrict(b6,b7,b9,b_);};};bm.PrepareTemplateStrict=function(b6,b7,b8,b9){var b_,b$;function ca(cg,ch){var ci,cj,ck,cl,cm,co,cp,cq,cr,cs,ct,cu,cv,cw,cx,cy,cz,cA,cB,cC,cD,cE,cF,cG,cH,cI;function cn(cJ){}while(true)switch(cg){case 0:if(ch!==null){ci=ch.nextSibling;if(bN.Equals(ch.nodeType,bZ.TEXT_NODE))bn.convertTextNode(ch);else if(bN.Equals(ch.nodeType,bZ.ELEMENT_NODE))cc(ch);ch=ci;}else return null;break;case 1:co=b0.string(ch.nodeName,{$:1,$0:3},null).toLowerCase();cp=(cj=co.indexOf("."),cj===-1?[b6,co]:[b0.string(co,null,{$:1,$0:cj-1}),b0.string(co,{$:1,$0:cj+1},null)]);cq=cp[1];cr=cp[0];if(cr!==""&&!bm.LoadedTemplates().ContainsKey(cr))return bn.failNotLoaded(cq);else{if(cr===""&&b9!=null)b9.$0(cq);cs=bm.LoadedTemplates().Item(cr);if(!cs.ContainsKey(cq))return bn.failNotLoaded(cq);else{ct=cs.Item(cq);cu=ct.cloneNode(true);cv=new bK.New$3();cw=new bV.New$5();cx=ch.attributes;for(cy=0,cz=cx.length-1;cy<=cz;cy++){cA=cx.item(cy).name.toLowerCase();cw.set_Item(cA,(cB=cx.item(cy).nodeValue,cB===""?cA:cB.toLowerCase()));if(!cv.SAdd(cA))bO.warn("Hole mapped twice",cA);}for(cC=0,cD=ch.childNodes.length-1;cC<=cD;cC++){cE=ch.childNodes[cC];if(bN.Equals(cE.nodeType,bZ.ELEMENT_NODE))!cv.SAdd(cE.nodeName.toLowerCase())?bO.warn("Hole filled twice",cq):void 0;}cF=ch.childNodes.length===1&&bN.Equals(ch.firstChild.nodeType,bZ.TEXT_NODE);if(cF){cl=bn.fillTextHole(cu,ch.firstChild.textContent,cq);((function(cJ){return function(cK){if(cK!=null)cJ(cK.$0);};}((cm=function(cJ){return function(cK){return cJ.SAdd(cK);};}(cv),function(cJ){return cn(cm(cJ));})))(cl));}bn.removeHolesExcept(cu,cv);if(!cF){for(cG=0,cH=ch.childNodes.length-1;cG<=cH;cG++){cI=ch.childNodes[cG];if(bN.Equals(cI.nodeType,bZ.ELEMENT_NODE))cI.hasAttributes()?bn.fillInstanceAttrs(cu,cI):cb(cu,cI);}}bn.mapHoles(cu,cw);bn.fill(cu,ch.parentNode,ch);ch.parentNode.removeChild(ch);return;}}break;}}function cb(cg,ch){var ci,cj,cl,cm;function ck(cn,co){var cp;if(cl==="title"&&ch.hasChildNodes()){cp=r.ParseHTMLIntoFakeRoot(ch.textContent);ch.removeChild(ch.firstChild);while(cp.hasChildNodes())ch.appendChild(cp.firstChild);}else null;cc(ch);return bn.fill(ch,cn,co);}cl=ch.nodeName.toLowerCase();bm.foreachNotPreserved(cg,"[ws-attr-holes]",function(cn){var co,cp,cq,cr,cs;co=bH.SplitChars(cn.getAttribute("ws-attr-holes"),[" "],1);for(cp=0,cq=co.length-1;cp<=cq;cp++){cr=bF.get(co,cp);cn.setAttribute(cr,(cs=new a.RegExp("\\${"+cl+"}","ig"),cn.getAttribute(cr).replace(cs,ch.textContent)));}});cm=cg.querySelector("[ws-hole="+cl+"]");if(bN.Equals(cm,null)){ci=cg.querySelector("[ws-replace="+cl+"]");return bN.Equals(ci,null)?(cj=cg.querySelector("slot[name="+cl+"]"),cg.tagName.toLowerCase()==="template"?(ck(cj.parentNode,cj),void cj.parentNode.removeChild(cj)):null):(ck(ci.parentNode,ci),void ci.parentNode.removeChild(ci));}else{while(cm.hasChildNodes())cm.removeChild(cm.lastChild);cm.removeAttribute("ws-hole");return ck(cm,null);}}function cc(cg){if(!cg.hasAttribute("ws-preserve"))if(bH.StartsWith(cg.nodeName.toLowerCase(),"ws-"))ce(cg);else{bn.convertAttrs(cg);cd(cg.firstChild);}}function cd(cg){return ca(0,cg);}function ce(cg){return ca(1,cg);}function cf(cg){var ch,ci,cj,ck,cl,cm,cn,co,cp,cq,cr,cs;while(true){ch=cg.querySelector("[ws-template]");if(bN.Equals(ch,null)){ci=cg.querySelector("[ws-children-template]");if(bN.Equals(ci,null)){cj=cg.querySelectorAll("template[id]");for(ck=1,cl=cj.length-1;ck<=cl;ck++){cm=cj[ck];if(b_.Contains(cm));else{bm.PrepareTemplateStrict(b6,{$:1,$0:cm.getAttribute("id")},cm,null);b_.SAdd(cm);}}cn=cg.querySelectorAll("template[name]");for(co=1,cp=cn.length-1;co<=cp;co++){cq=cn[co];if(b_.Contains(cq));else{bm.PrepareTemplateStrict(b6,{$:1,$0:cq.getAttribute("name")},cq,null);b_.SAdd(cq);}}return null;}else{cr=ci.getAttribute("ws-children-template");ci.removeAttribute("ws-children-template");bm.PrepareTemplateStrict(b6,{$:1,$0:cr},ci,null);cg=cg;}}else{cs=ch.getAttribute("ws-template");(bm.PrepareSingleTemplate(b6,{$:1,$0:cs},ch))(null);cg=cg;}}}b_=new bK.New$3();b$=(b7==null?"":b7.$0).toLowerCase();bm.LoadedTemplateFile(b6).set_Item(b$,b8);if(b8.hasChildNodes()){cf(b8);cd(b8.firstChild);}};bm.FakeRootSingle=function(b6){var b7,b8,b9,b_;b6.removeAttribute("ws-template");b7=b6.getAttribute("ws-replace");if(b7===null);else{b6.removeAttribute("ws-replace");b8=b6.parentNode;bN.Equals(b8,null)?void 0:(b9=self.document.createElement(b6.tagName),b9.setAttribute("ws-replace",b7),b8.replaceChild(b9,b6));}b_=self.document.createElement("div");b_.appendChild(b6);return b_;};bm.FakeRootFromHTMLTemplate=function(b6){var b7,b8,b9,b_;b7=self.document.createElement("div");b8=b6.content;for(b9=0,b_=b8.childNodes.length-1;b9<=b_;b9++)b7.appendChild(b8.childNodes[b9].cloneNode(true));return b7;};bm.FakeRoot=function(b6){var b7;b7=self.document.createElement("div");while(b6.hasChildNodes())b7.appendChild(b6.firstChild);return b7;};bm.ChildrenTemplate=function(b6,b7){var b8,b9,b_,b$,ca;b8=bm.InlineTemplate(b6,bL.append(b7,bm.GlobalHoles().Values()));b9=b8[1];b_=b8[0];b$=b_.Els;return!bN.Equals(b$,null)&&b$.length===1&&(bF.get(b$,0)instanceof bZ&&(bN.Equals(bF.get(b$,0).nodeType,bZ.ELEMENT_NODE)&&(ca=bF.get(b$,0),true)))?bj.TreeNode(b_,b9):bi.Mk({$:6,$0:b_},b9);};bm.InlineTemplate=function(b6,b7){var b8,b9,b_,b$,ca,ce,cf,cg,ch,ci,cj,ck;function cb(cl,cm){var cn,co,cp;cn=_6.Insert(cl,cm);cf.push(_6.Updates(cn));cg.push([cl,cn]);co=bM.GetOptional(cn.OnAfterRender);return co==null?null:(cp=co.$0,void ch.push(function(){cp(cl);}));}function cc(cl){var cm,cn;cm=(cn=null,[ci.TryGetValue(cl,{get:function(){return cn;},set:function(co){cn=co;}}),cn]);return cm[0]?cm[1].$==0?{$:1,$0:cm[1].$1}:cm[1].$==1?{$:1,$0:bi.TextNode(cm[1].$1)}:cm[1].$==2?{$:1,$0:bi.TextView(cm[1].$1)}:cm[1].$==10?{$:1,$0:bi.TextView(cm[1].$1.get_View())}:cm[1].$==11?{$:1,$0:bi.TextView(y.Map(a.String,cm[1].$1.get_View()))}:cm[1].$==12?{$:1,$0:bi.TextView(y.Map(function(co){return(new a.Date(co)).toLocaleString();},cm[1].$1.get_View()))}:cm[1].$==13?{$:1,$0:bi.TextView(y.Map(a.String,cm[1].$1.get_View()))}:cm[1].$==15?{$:1,$0:bi.TextView(y.Map(function(co){return co.get_Input();},cm[1].$1.get_View()))}:cm[1].$==16?{$:1,$0:bi.TextView(y.Map(a.String,cm[1].$1.get_View()))}:cm[1].$==17?{$:1,$0:bi.TextView(y.Map(function(co){return co.get_Input();},cm[1].$1.get_View()))}:cm[1].$==18?{$:1,$0:bi.TextView(y.Map(a.String,cm[1].$1.get_View()))}:(bO.warn("Content hole filled with attribute data",cl),null):null;}function cd(){bm.foreachNotPreservedwsDOM("[ws-dom]",function(cl){var cm,cn,co,cp,cq,cr;cm=(cn=null,[ci.TryGetValue(cl.getAttribute("ws-dom").toLowerCase(),{get:function(){return cn;},set:function(cs){cn=cs;}}),cn]);if(cm[0])cm[1].$==14?(co=cm[1].$1,cl.removeAttribute("ws-dom"),cp=cl,cq=new a.MutationObserver(function(cs,ct){bF.iter(function(cu){function cv(cw,cx,cy,cz){if(cw===cp&&cu.addedNodes.length!==1){co.SetFinal(null);ct.disconnect();}}cu.removedNodes.forEach(bM.CreateFuncWithArgs(function(cw){return cv(cw[0],cw[1],cw[2],cw[3]);}),null);},cs);}),cl.parentElement!==null?cq.observe(cl.parentElement,(cr={},cr.childList=true,cr)):void 0,co.Set({$:1,$0:cl}),y.Sink(function(cs){var ct;if(cs!=null&&cs.$==1){ct=cs.$0;if(cp===ct);else{cp.replaceWith.apply(cp,[ct]);cp=ct;}}else{cp.remove();cq.disconnect();}},co.get_View())):void 0;});}ce=[];cf=[];cg=[];ch=[];ci=new bV.New$5();cj=bG.Get(b7);try{while(cj.MoveNext()){ck=cj.Current();ci.set_Item(ck.$0,ck);}}finally{if(typeof cj=="object"&&"Dispose"in cj)cj.Dispose();}b8=r.ChildrenArray(b6);bm.foreachNotPreserved(b6,"[ws-hole]",function(cl){var cm,cn,co;co=cl.getAttribute("ws-hole");cl.removeAttribute("ws-hole");while(cl.hasChildNodes())cl.removeChild(cl.lastChild);cm=cc(co);if(cm!=null&&cm.$==1){cn=cm.$0;bh.LinkElement(cl,cn.docNode);ce.push(bc.New(_6.Empty(cl),cn.docNode,null,cl,h.Int(),null));cf.push(cn.updates);}});bm.foreachNotPreserved(b6,"[ws-replace]",function(cl){var cm,cn,co,cp,cq,cr;cm=cc(cl.getAttribute("ws-replace"));if(cm!=null&&cm.$==1){cn=cm.$0;co=cl.parentNode;cp=self.document.createTextNode("");co.replaceChild(cp,cl);cq=bh.InsertBeforeDelim(cp,cn.docNode);cr=bF.tryFindIndex(function(cs){return cl===cs;},b8);cr==null?void 0:bF.set(b8,cr.$0,cn.docNode);ce.push(bc.New(_6.Empty(co),cn.docNode,{$:1,$0:[cq,cp]},co,h.Int(),null));cf.push(cn.updates);}});b9=false;bm.foreachNotPreserved(b6,"slot",function(cl){var cm,cn,co,cp;co=cl.getAttribute("name");cp=co===""||co===null?"default":co.toLowerCase();if(b9&&cp==="default"||!bN.Equals(b6.parentElement,null))void 0;else{while(cl.hasChildNodes())cl.removeChild(cl.lastChild);if(cp==="default")b9=true;cm=cc(cp);if(cm!=null&&cm.$==1){cn=cm.$0;bh.LinkElement(cl,cn.docNode);ce.push(bc.New(_6.Empty(cl),cn.docNode,null,cl,h.Int(),null));cf.push(cn.updates);}}});bm.foreachNotPreserved(b6,"[ws-attr]",function(cl){var cm,cn,co;cm=cl.getAttribute("ws-attr");cl.removeAttribute("ws-attr");cn=(co=null,[ci.TryGetValue(cm,{get:function(){return co;},set:function(cp){co=cp;}}),co]);if(cn[0])cn[1].$==3?cb(cl,cn[1].$1):bO.warn("Attribute hole filled with non-attribute data",cm);});bm.foreachNotPreserved(b6,"[ws-on]",function(cl){cb(cl,_2.Concat(bF.choose(function(cm){var cn,co,cp;cn=bH.SplitChars(cm,[":"],1);co=(cp=null,[ci.TryGetValue(bF.get(cn,1),{get:function(){return cp;},set:function(cq){cp=cq;}}),cp]);return co[0]?co[1].$==4?{$:1,$0:_9.Handler(bF.get(cn,0),co[1].$1)}:co[1].$==5?{$:1,$0:_2.Handler(bF.get(cn,0),co[1].$1)}:(bO.warn("Event hole on"+bF.get(cn,0)+" filled with non-event data",bF.get(cn,1)),null):null;},bH.SplitChars(cl.getAttribute("ws-on"),[" "],1))));cl.removeAttribute("ws-on");});bm.foreachNotPreserved(b6,"[ws-onafterrender]",function(cl){var cm,cn,co;cm=cl.getAttribute("ws-onafterrender");cn=(co=null,[ci.TryGetValue(cm,{get:function(){return co;},set:function(cp){co=cp;}}),co]);if(cn[0])cn[1].$==7?(cl.removeAttribute("ws-onafterrender"),cb(cl,_9.OnAfterRender(cn[1].$1))):cn[1].$==8?(cl.removeAttribute("ws-onafterrender"),cb(cl,_9.OnAfterRender(cn[1].$1))):bO.warn("onafterrender hole filled with non-onafterrender data",cm);});bm.foreachNotPreserved(b6,"[ws-var]",function(cl){var cm,cn,co;cm=cl.getAttribute("ws-var");cl.removeAttribute("ws-var");cn=(co=null,[ci.TryGetValue(cm,{get:function(){return co;},set:function(cp){co=cp;}}),co]);if(cn[0])cn[1].$==10?cb(cl,_9.Value(cn[1].$1)):cn[1].$==11?cb(cl,_9.Checked(cn[1].$1)):cn[1].$==12?cb(cl,_9.DateTimeValue(cn[1].$1)):cn[1].$==13?cb(cl,_9.FileValue(cn[1].$1)):cn[1].$==15?cb(cl,_9.IntValue(cn[1].$1)):cn[1].$==16?cb(cl,_9.IntValueUnchecked(cn[1].$1)):cn[1].$==17?cb(cl,_9.FloatValue(cn[1].$1)):cn[1].$==18?cb(cl,_9.FloatValueUnchecked(cn[1].$1)):bO.warn("Var hole filled with non-Var data",cm);});bm.foreachNotPreserved(b6,"[ws-attr-holes]",function(cl){var cm,cn,co,cp;cm=new a.RegExp(bm.TextHoleRE(),"g");cn=bH.SplitChars(cl.getAttribute("ws-attr-holes"),[" "],1);cl.removeAttribute("ws-attr-holes");for(co=0,cp=cn.length-1;co<=cp;co++)(function(){var cq,cr,cs,ct,cu,cv,cw,cx,cy,cz,cA,cB,cC;cz=bF.get(cn,co);cA=cl.getAttribute(cz);cq=null;cr=0;cB=[];while(cq=cm.exec(cA),cq!==null){cC=b0.string(cA,{$:1,$0:cr},{$:1,$0:cm.lastIndex-bF.get(cq,0).length-1});cr=cm.lastIndex;cB.push([cC,bF.get(cq,1)]);}ct=b0.string(cA,{$:1,$0:cr},null);cm.lastIndex=0;cu=bF.foldBack(function(cD,cE){return(function(cF){var cG,cH;cG=cF[0];cH=cF[1];return function(cI){var cJ,cK,cL,cM,cN;cJ=cI[0];cK=cI[1];cL=(cM=(cN=null,[ci.TryGetValue(cH,{get:function(){return cN;},set:function(cO){cN=cO;}}),cN]),cM[0]?cM[1].$==1?{$:0,$0:cM[1].$1}:cM[1].$==2?{$:1,$0:cM[1].$1}:cM[1].$==10?{$:1,$0:cM[1].$1.get_View()}:cM[1].$==11?{$:1,$0:y.Map(a.String,cM[1].$1.get_View())}:cM[1].$==12?{$:1,$0:y.Map(function(cO){return(new a.Date(cO)).toLocaleString();},cM[1].$1.get_View())}:cM[1].$==13?{$:1,$0:y.Map(a.String,cM[1].$1.get_View())}:cM[1].$==15?{$:1,$0:y.Map(function(cO){return cO.get_Input();},cM[1].$1.get_View())}:cM[1].$==16?{$:1,$0:y.Map(a.String,cM[1].$1.get_View())}:cM[1].$==17?{$:1,$0:y.Map(function(cO){return cO.get_Input();},cM[1].$1.get_View())}:cM[1].$==18?{$:1,$0:y.Map(a.String,cM[1].$1.get_View())}:(bO.warn("Attribute value hole filled with non-text data",cH),{$:0,$0:""}):{$:0,$0:""});return cL.$==1?[cG,new bE.T({$:1,$0:cJ===""?cL.$0:y.Map(function(cO){return cO+cJ;},cL.$0),$1:cK})]:[cG+cL.$0+cJ,cK];};}(cD))(cE);},cB,[ct,bE.T.Empty]);return cb(cl,cu[1].$==1?cu[1].$1.$==1?cu[1].$1.$1.$==1?cu[1].$1.$1.$1.$==0?(cv=cu[0],_9.Dynamic(cz,y.Map3(function(cD,cE,cF){return cv+cD+cE+cF;},cu[1].$0,cu[1].$1.$0,cu[1].$1.$1.$0))):(cw=cu[0],_9.Dynamic(cz,y.Map(function(cD){return cw+bH.concat("",cD);},y.Sequence(cu[1])))):(cx=cu[0],_9.Dynamic(cz,y.Map2(function(cD,cE){return cx+cD+cE;},cu[1].$0,cu[1].$1.$0))):cu[0]===""?_9.Dynamic(cz,cu[1].$0):(cy=cu[0],_9.Dynamic(cz,y.Map(function(cD){return cy+cD;},cu[1].$0))):_2.Create(cz,cu[0]));}());});return[bM.DeleteEmptyFields({Els:b8,Dirty:true,Holes:ce,Attrs:cg,Render:(b_=ch.length==0?{$:1,$0:function(){cd();}}:{$:1,$0:function(cl){cd();bF.iter(function(cm){cm(cl);},ch);}},b_?b_.$0:void 0),El:(b$=!bN.Equals(b8,null)&&b8.length===1&&(bF.get(b8,0)instanceof bZ&&(bF.get(b8,0)instanceof a.Element&&(ca=bF.get(b8,0),true)))?{$:1,$0:ca}:null,b$?b$.$0:void 0)},["Render","El"]),d.TreeReduce(y.Const(),y.Map2Unit,cf)];};bm.foreachNotPreservedwsDOM=function(b6,b7){r.IterSelectorDoc(b6,function(b8){if(b8.closest("[ws-preserve]")==null)b7(b8);});};bm.foreachNotPreserved=function(b6,b7,b8){r.IterSelector(b6,b7,function(b9){if(b9.closest("[ws-preserve]")==null)b8(b9);});};bm.TextHoleRE=function(){bo.$cctor();return bo.TextHoleRE;};bm.GlobalHoles=function(){bo.$cctor();return bo.GlobalHoles;};bm.set_GlobalHoles=function(b6){bo.$cctor();bo.GlobalHoles=b6;};bm.LocalTemplatesLoaded=function(){bo.$cctor();return bo.LocalTemplatesLoaded;};bm.set_LocalTemplatesLoaded=function(b6){bo.$cctor();bo.LocalTemplatesLoaded=b6;};bm.LoadedTemplateFile=function(b6){var b7,b8,b9;b7=(b8=null,[bm.LoadedTemplates().TryGetValue(b6,{get:function(){return b8;},set:function(b_){b8=b_;}}),b8]);return b7[0]?b7[1]:(b9=new bV.New$5(),(bm.LoadedTemplates().set_Item(b6,b9),b9));};bm.LoadedTemplates=function(){bo.$cctor();return bo.LoadedTemplates;};bo.$cctor=function(){bo.$cctor=a.ignore;bo.LoadedTemplates=new bV.New$5();bo.LocalTemplatesLoaded=false;bo.GlobalHoles=new bV.New$5();bo.TextHoleRE="\\${([^}]+)}";bo.RenderedFullDocTemplate=null;};bp=c.Flow=bM.Class({get_Render:function(){return this.render;}},k,bp);bp.New=bM.Ctor(function(b6){bp.New$1.call(this,function(b7){return function(b8){return A.Set(b7,b6(b8));};});},bp);bp.New$1=bM.Ctor(function(b6){k.New.call(this);this.render=b6;},bp);bp.get_Do=function(){return new bq.New();};bp.Static=function(b6){return new bp.New$1(function(b7){return function(b8){A.Set(b7,b6);return b8();};});};bp.Define=function(b6){return new bp.New(function(b7){return b6(function(b8){b7(b8);});});};bp.Embed=function(b6){var b7;b7=A.Create$1(bi.get_Empty());((b6.get_Render())(b7))(a.ignore);return bi.EmbedView(b7.get_View());};bp.Return=function(b6){return new bp.New$1(function(){return function(b7){return b7(b6);};});};bp.Bind=function(b6,b7){return new bp.New$1(function(b8){return function(b9){return((b6.get_Render())(b8))(function(b_){((b7(b_).get_Render())(b8))(b9);});};});};bp.Map=function(b6,b7){return new bp.New$1(function(b8){return function(b9){return((b7.get_Render())(b8))(function(b_){b9(b6(b_));});};});};bq=c.FlowBuilder=bM.Class({ReturnFrom:a.id,Return:function(b6){return bp.Return(b6);},Bind:function(b6,b7){return bp.Bind(b6,b7);}},k,bq);bq.New=bM.Ctor(function(){k.New.call(this);},bq);bs=br.attr=bM.Class({},k,bs);bs.New=bM.Ctor(function(){k.New.call(this);},bs);bt.InstallHash=function(b6,b7){var b8;b8=A.Create$1(void 0);bt.InstallHashInto(b8,b6,b7);return b8;};bt.InstallHashInto=function(b6,b7,b8){function b9(ca){return b2.Parse(b8,b3.FromHash(ca,{$:1,$0:true}));}function b_(){return bt.getCurrentHash(b9,b7);}function b$(ca){if(!bN.Equals(b6.Get(),ca))b6.Set(ca);}b$(b_());self.addEventListener("popstate",function(){return b$(b_());},false);self.addEventListener("hashchange",function(){return b$(b_());},false);self.document.body.addEventListener("click",function(ca){var cb,cc,cd;cb=(cc=bt.findLinkHref(ca.target),cc==null?null:(cd=cc.$0,bH.StartsWith(cd,"#")?b9(cd):null));return cb==null?null:(b$(cb.$0),ca.preventDefault());},false);y.Sink(function(ca){var cb;if(!bN.Equals(ca,b_())){cb=b2.HashLink(b8,ca);self.history.pushState(null,null,cb);}},b6.get_View());};bt.getCurrentHash=function(b6,b7){var b8,b9;b8=self.location.hash;b9=b6(b8);return b9==null?((function(b_){return function(b$){return b_("Failed to parse route: "+b4.toSafe(b$));};}(function(b_){bO.log(b_);}))(b8),b7):b9.$0;};bt.Install=function(b6,b7){var b8;b8=A.Create$1(void 0);bt.InstallInto(b8,b6,b7);return b8;};bt.InstallInto=function(b6,b7,b8){function b9(ca){return b2.Parse(b8,ca);}function b_(){return bt.getCurrent(b9,b7);}function b$(ca){if(!bN.Equals(b6.Get(),ca))b6.Set(ca);}b$(b_());self.addEventListener("popstate",function(){return b$(b_());},false);self.document.body.addEventListener("click",function(ca){var cb,cc,cd;cb=(cc=(cd=bt.findLinkHref(ca.target),cd==null?null:bt.hrefToAbsolute(cd.$0)),cc==null?null:b9(b3.FromUrl(cc.$0,null)));return cb==null?null:(b$(cb.$0),ca.preventDefault());},false);y.Sink(function(ca){var cb;if(!bN.Equals(ca,b_())){cb=b2.Link(b8,ca);self.history.pushState(null,null,cb);}},b6.get_View());};bt.findLinkHref=function(b6){while(true)if(b6.tagName==="A")return b5.ofObj(b6.getAttribute("href"));else if(b6===self.document.body)return null;else b6=b6.parentNode;};bt.hrefToAbsolute=function(b6){var b7;return bH.StartsWith(b6,"?")?{$:1,$0:bt.trimFragment(self.location.pathname+b6)}:bH.StartsWith(b6,"#")?null:bH.StartsWith(b6,"/")?{$:1,$0:bt.trimFragment(b6)}:(new a.RegExp("^[a-zA-Z0-9]:")).test(b6)?null:(b7=self.location.pathname,{$:1,$0:bt.trimFragment(b0.string(b7,null,{$:1,$0:b7.lastIndexOf("/")})+b6)});};bt.trimFragment=function(b6){var b7;b7=b6.indexOf("#");return b7===-1?b6:b0.string(b6,null,{$:1,$0:b7-1});};bt.getCurrent=function(b6,b7){var b8,b9,b_;b8=self.location;b9=b3.FromUrl(b8.pathname+b8.search,null);b_=b6(b9);return b_==null?((function(b$){return function(ca){return b$("Failed to parse route: "+b4.toSafe(ca));};}(function(b$){bO.log(b$);}))(b9.ToLink()),b7):b_.$0;};bu.Append=function(b6,b7){return{$:0,$0:p.Append(b6.$0,b7.$0),$1:bQ.FoldBack(function(b8,b9,b_){return b_.Add$1(b8,b9);},b6.$1,b7.$1)};};bu.FromList=function(b6,b7){return{$:0,$0:p.FromArray(bF.ofList(b6)),$1:b7};};bu.ToList=function(b6){return[bE.ofArray(p.ToArray(b6.$0)),b6.$1];};bu.SameHash=function(b6,b7){return bu.NoHash(b6)===bu.NoHash(b7);};bu.MakeHash=function(b6){var b7,b8;b7=b6.$1;b8=bH.concat("/",bF.map(function(b9){return a.encodeURIComponent(b9);},p.ToArray(b6.$0)));return b7.get_IsEmpty()?b8:b8+"?"+bH.concat("&",bL.map(function(b9){var b_;b_=bS.KeyValue(b9);return a.encodeURIComponent(b_[0])+"="+a.encodeURIComponent(b_[1]);},b7));};bu.ParseHash=function(b6){var b7,b8,b9,b_;b7=bu.NoHash(b6);b8=(b9=b7.indexOf("?"),b9===-1?[b7,""]:[b0.string(b7,null,{$:1,$0:b9-1}),b0.string(b7,{$:1,$0:b9+1},null)]);b_=b8[0];return{$:0,$0:p.FromArray(b_===""?[]:bF.map(function(b$){return a.decodeURIComponent(b$);},bH.SplitChars(b_,["/"],0))),$1:bQ.OfArray(bF.map(function(b$){var ca;ca=b$.indexOf("=");return ca===-1?[a.decodeURIComponent(b$),""]:[a.decodeURIComponent(b0.string(b$,null,{$:1,$0:ca-1})),a.decodeURIComponent(b0.string(b$,{$:1,$0:ca+1},null))];},bH.SplitChars(b8[1],["&"],0)))};};bu.NoHash=function(b6){return bH.StartsWith(b6,"#")?b6.substring(1):b6;};bv.DoLink=function(b6,b7){var b8;b8=b6.Ser(b7);return bu.FromList(b8[0],b8[1]);};bv.DoRoute=function(b6,b7){return b6.Des(bu.ToList(b7));};bv.InstallMap=function(b6){var b7;function b8(ca,cb){return bN.Equals(b6.Ser(ca),b6.Ser(cb));}function b9(){return b6.Des(bu.ToList(bu.ParseHash(self.location.hash)));}function b_(ca){if(!b8(b7.Get(),ca))b7.Set(ca);}function b$(ca){return b_(b9());}b7=A.Create$1(b9());self.onpopstate=b$;self.onhashchange=b$;y.Sink(function(ca){var cb,cc;cb=bu.MakeHash((cc=b6.Ser(ca),bu.FromList(cc[0],cc[1])));if(!bu.SameHash(self.location.hash,cb))self.location.replace("#"+cb);},b7.get_View());return b7;};bw.Install=function(b6){return bv.InstallMap(b6);};bw.Create=function(b6,b7){function b8(b9){return b9[0];}return{Des:function(b9){return b7(b8(b9));},Ser:function(b9){return[b6(b9),new bR.New([])];}};};bw.CreateWithQuery=function(b6,b7){return{Des:b7,Ser:b6};};by.New=function(b6,b7){return{Active:b6,PosV:b7};};bz.New=function(b6,b7,b8,b9){return{Active:b6,Left:b7,Middle:b8,Right:b9};};bA.get_MousePressed=function(){bx.ActivateButtonListener();return y.Apply(y.Apply(y.Apply(y.Const(bM.Curried3(function(b6,b7,b8){return b6||b7||b8;})),bx.MouseBtnSt$1().Left.get_View()),bx.MouseBtnSt$1().Middle.get_View()),bx.MouseBtnSt$1().Right.get_View());};bA.get_RightPressed=function(){bx.ActivateButtonListener();return bx.MouseBtnSt$1().Right.get_View();};bA.get_MiddlePressed=function(){bx.ActivateButtonListener();return bx.MouseBtnSt$1().Middle.get_View();};bA.get_LeftPressed=function(){bx.ActivateButtonListener();return bx.MouseBtnSt$1().Left.get_View();};bA.get_Position=function(){!bx.MousePosSt$1().Active?(self.document.addEventListener("mousemove",function(b6){return A.Set(bx.MousePosSt$1().PosV,[b6.clientX,b6.clientY]);}),bx.MousePosSt$1().Active=true):void 0;return bx.MousePosSt$1().PosV.get_View();};bB.New=function(b6,b7,b8){return{KeysPressed:b6,KeyListenerActive:b7,LastPressed:b8};};bC.IsPressed=function(b6){function b7(b8){return b8===b6;}bx.ActivateKeyListener();return y.Map(function(b8){return bE.exists(b7,b8);},bx.KeyListenerState().KeysPressed.get_View());};bC.get_LastPressed=function(){bx.ActivateKeyListener();return bx.KeyListenerState().LastPressed.get_View();};bC.get_KeysPressed=function(){bx.ActivateKeyListener();return bx.KeyListenerState().KeysPressed.get_View();};bx.ActivateKeyListener=function(){bD.$cctor();return bD.ActivateKeyListener;};bx.KeyListenerState=function(){bD.$cctor();return bD.KeyListenerState;};bx.ActivateButtonListener=function(){bD.$cctor();return bD.ActivateButtonListener;};bx.MouseBtnSt$1=function(){bD.$cctor();return bD.MouseBtnSt;};bx.MousePosSt$1=function(){bD.$cctor();return bD.MousePosSt;};bD.$cctor=function(){bD.$cctor=a.ignore;function b6(b7,b8){var b9;b9=b7.button;return b9===0?A.Set(bx.MouseBtnSt$1().Left,b8):b9===1?A.Set(bx.MouseBtnSt$1().Middle,b8):b9===2?A.Set(bx.MouseBtnSt$1().Right,b8):null;}bD.MousePosSt=by.New(false,A.Create$1([0,0]));bD.MouseBtnSt=bz.New(false,A.Create$1(false),A.Create$1(false),A.Create$1(false));bD.ActivateButtonListener=!bx.MouseBtnSt$1().Active?(bx.MouseBtnSt$1().Active=true,self.document.addEventListener("mousedown",function(b7){return b6(b7,true);}),self.document.addEventListener("mouseup",function(b7){return b6(b7,false);})):null;bD.KeyListenerState=bB.New(A.Create$1(bE.T.Empty),false,A.Create$1(-1));bD.ActivateKeyListener=!bx.KeyListenerState().KeyListenerActive?(bx.KeyListenerState().KeyListenerActive=true,self.document.addEventListener("keydown",function(b7){var b8,b9,b_;b8=b7.which;b9=b8===null?b7.keyCode:b8;A.Set(bx.KeyListenerState().LastPressed,b9);b_=bx.KeyListenerState().KeysPressed.Get();return!bE.exists(function(b$){return b$===b9;},b_)?bx.KeyListenerState().KeysPressed.Set(bE.append(b_,bE.ofArray([b9]))):null;}),self.document.addEventListener("keyup",function(b7){var b8,b9;function b_(b$){return b$!==b9;}b8=b7.which;b9=b8===null?b7.keyCode:b8;return A.Update(bx.KeyListenerState().KeysPressed,function(b$){return bE.filter(b_,b$);});})):null;};}(self));
